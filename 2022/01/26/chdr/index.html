<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>进程模块库 | Airshelf&#39;s blog</title>
  <meta name="description" content="原始项目地址https:&#x2F;&#x2F;github.com&#x2F;ch4ncellor&#x2F;chdr 代码头文件 &#x2F;&#x2F;chdr.h #pragma once  #include &lt;Windows.h&gt; #include &lt;vector&gt; #include &lt;winnt.h&gt; #include &lt;TlHelp32.h&gt; #include &lt;fstream&gt; #include &lt;com">
<meta property="og:type" content="article">
<meta property="og:title" content="进程模块库">
<meta property="og:url" content="http://airshelf.github.io/2022/01/26/chdr/index.html">
<meta property="og:site_name" content="Airshelf&#39;s Blog">
<meta property="og:description" content="原始项目地址https:&#x2F;&#x2F;github.com&#x2F;ch4ncellor&#x2F;chdr 代码头文件 &#x2F;&#x2F;chdr.h #pragma once  #include &lt;Windows.h&gt; #include &lt;vector&gt; #include &lt;winnt.h&gt; #include &lt;TlHelp32.h&gt; #include &lt;fstream&gt; #include &lt;com">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-26T09:38:35.000Z">
<meta property="article:modified_time" content="2022-01-26T09:42:00.807Z">
<meta property="article:author" content="Airshelf">
<meta property="article:tag" content="代码">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://airshelf.github.io/2022/01/26/chdr/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Airshelf&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-cb.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body class="main-center theme-blue" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/airshelf" target="_blank">
          <img class="img-circle img-rotate" src="/images/male.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Airshelf</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Day Day Up</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shanghai, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">自律 == 自由</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>笔记站点 记录所学</p>
            </div>
        </div>
    </div>
</div>

    
      

    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81/" rel="tag">代码</a><span class="tag-list-count">41</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%8D%E6%9D%80/" rel="tag">免杀</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%9F%E8%83%BD/" rel="tag">功能</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%86%E5%90%91/" rel="tag">逆向</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/01/26/chdr/" class="title">进程模块库</a>
              </p>
              <p class="item-date">
                <time datetime="2022-01-26T09:38:35.000Z" itemprop="datePublished">2022-01-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/01/25/StrongDel/" class="title">内核强删文件</a>
              </p>
              <p class="item-date">
                <time datetime="2022-01-25T08:23:35.000Z" itemprop="datePublished">2022-01-25</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/01/17/NoAccessProtection/" class="title">NoAccess代码保护方法</a>
              </p>
              <p class="item-date">
                <time datetime="2022-01-17T07:51:14.000Z" itemprop="datePublished">2022-01-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/12/14/AllocExecMemory/" class="title">申请隐蔽的可执行内存</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-14T02:12:05.000Z" itemprop="datePublished">2021-12-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/11/10/VADList/" class="title">内核枚举进程内存属性</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-10T02:48:07.000Z" itemprop="datePublished">2021-11-10</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-chdr" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      进程模块库
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/01/26/chdr/" class="article-date">
	  <time datetime="2022-01-26T09:38:35.000Z" itemprop="datePublished">2022-01-26</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/%E4%BB%A3%E7%A0%81/" rel="tag">代码</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/01/26/chdr/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 9.2k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 57(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h3 id="原始项目地址"><a href="#原始项目地址" class="headerlink" title="原始项目地址"></a>原始项目地址</h3><p><a target="_blank" rel="noopener" href="https://github.com/ch4ncellor/chdr">https://github.com/ch4ncellor/chdr</a></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>头文件</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">//chdr.h</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;winnt.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TlHelp32.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;comdef.h></span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;functional></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;map></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Psapi.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;filesystem></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;winternl.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string_view></span></span>

namespace chdr
<span class="token punctuation">{</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> CH_R_CAST reinterpret_cast</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> CH_S_CAST static_cast</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> CH_D_CAST dynamic_cast</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> CH_C_CAST const_cast</span>

    namespace misc
    <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">define</span> XOR(str) []() { constexpr auto s = chdr::misc::StringEncryption&lt;sizeof(str) / sizeof(str[0])>(str); return s.Decrypted(); }()</span>
        constexpr std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t COMPILETIME_SEED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Temp, make this more unique lmfao.</span>

        template <span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t nStringSize<span class="token operator">></span>
        class StringEncryption
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>int8_t m_Xored<span class="token punctuation">[</span>nStringSize<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        public<span class="token punctuation">:</span>
            constexpr <span class="token function">StringEncryption</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szToEncrypt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nStringSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>int8_t<span class="token operator">></span><span class="token punctuation">(</span>COMPILETIME_SEED <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> m_szToEncrypt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">Decrypted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
                <span class="token keyword">static</span> <span class="token keyword">char</span> m_DecryptedData<span class="token punctuation">[</span>nStringSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
                m_DecryptedData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">1u</span><span class="token punctuation">;</span> m_DecryptedData<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1u</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
                    m_DecryptedData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> m_DecryptedData<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">define</span> CREATE_XORED_POINTER(type, ptr) chdr::misc::PointerEncryption&lt;type>(ptr);</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> optimize( "", off )</span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span>
        class PointerEncryption
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_Xored<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        public<span class="token punctuation">:</span>
            <span class="token function">PointerEncryption</span><span class="token punctuation">(</span>T<span class="token operator">*</span> m_pToEncrypt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pToEncrypt<span class="token punctuation">)</span> <span class="token operator">^</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pToEncrypt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pToEncrypt<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>COMPILETIME_SEED <span class="token operator">*</span> <span class="token number">0xB00B1E</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            __forceinline T<span class="token operator">*</span> operator<span class="token operator">-></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> this<span class="token operator">-></span><span class="token function">Decrypted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            __forceinline bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span><span class="token function">Decrypted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            __forceinline T<span class="token operator">*</span> <span class="token function">Decrypted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>T<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> this<span class="token operator">-></span>m_Xored<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>COMPILETIME_SEED <span class="token operator">*</span> <span class="token number">0xB00B1E</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> optimize( "", on )</span>

<span class="token macro property">#<span class="token directive keyword">define</span> ADD_SCOPE_HANDLER(a, b) chdr::misc::QueuedScopeHandler ScopeHandler(a, b);</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PUSH_SCOPE_HANDLER(a, b) ScopeHandler.AddToTail(a, b);</span>

        <span class="token comment" spellcheck="true">// This is fine for now, but because the template is class-specific, you can't currently queue more than one type.</span>
        template <span class="token operator">&lt;</span>typename Callback<span class="token punctuation">,</span> typename<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Parameters<span class="token operator">></span>
        class QueuedScopeHandler
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>pair<span class="token operator">&lt;</span>Callback<span class="token punctuation">,</span> Parameters<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">>></span> m_QueuedCalls<span class="token punctuation">;</span>
        public<span class="token punctuation">:</span>
            <span class="token function">QueuedScopeHandler</span><span class="token punctuation">(</span>Callback call<span class="token punctuation">,</span> Parameters <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span> this<span class="token operator">-></span><span class="token function">AddToTail</span><span class="token punctuation">(</span>call<span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token operator">~</span><span class="token function">QueuedScopeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> QueuedCalls <span class="token punctuation">:</span> this<span class="token operator">-></span>m_QueuedCalls<span class="token punctuation">)</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">invoke</span><span class="token punctuation">(</span>QueuedCalls<span class="token punctuation">.</span>first<span class="token punctuation">,</span> QueuedCalls<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token keyword">void</span> <span class="token function">AddToTail</span><span class="token punctuation">(</span>Callback call<span class="token punctuation">,</span> Parameters <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>m_QueuedCalls<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span> call<span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">if</span> 1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> SHOULD_PRINT_DEBUG_LOGS </span><span class="token comment" spellcheck="true">// Log errors/verbose information.</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">ifdef</span> SHOULD_PRINT_DEBUG_LOGS</span>
    <span class="token comment" spellcheck="true">// Custom debug assert/log.</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CH_LOG(s, ...) { std::printf("[!] "); std::printf(XOR(s), __VA_ARGS__); std::printf("\n"); }</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CH_ASSERT(x, b, s, ...) if (!(b)) {  CH_LOG(s, __VA_ARGS__) if constexpr (x) return;  }</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
    <span class="token comment" spellcheck="true">// Custom debug assert/log.</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CH_LOG(s, ...) (void)0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CH_ASSERT(x, b, s, ...) if (!(b)) { if (x) return;  }</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

    <span class="token comment" spellcheck="true">// Custom casting macros, because fucking C++ style casts are just TOO long.</span>


    <span class="token comment" spellcheck="true">// For ease of use.</span>
    using ByteArray_t <span class="token operator">=</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">></span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// To be used internally by PEHeaderData_t.</span>
    class Process_t<span class="token punctuation">;</span>
    class Module_t<span class="token punctuation">;</span>
    class Driver_t<span class="token punctuation">;</span>

    class Module_t<span class="token punctuation">;</span>
    class Address_t<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// For easy and organized PE header parsing.</span>
    class PEHeaderData_t
    <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> SectionData_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string         m_szName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_Address <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_Size <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_Characteristics <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_PointerToRawData <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_SizeOfRawData <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">struct</span> ExportData_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t   m_nAddress <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t    m_nOrdinal <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">struct</span> ImportData_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string m_szModuleName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">struct</span> DebugData_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string         m_szPDBPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string            m_szGUIDSignature <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_Age <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_CVSignature <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Only for PDB7.0 format!</span>
        <span class="token keyword">struct</span> CV_INFO_PDB70 
        <span class="token punctuation">{</span>
            DWORD    CvSignature<span class="token punctuation">;</span>
            GUID    Signature<span class="token punctuation">;</span>
            DWORD    Age<span class="token punctuation">;</span>
            BYTE    PdbFileName<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// For caching desired data.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>SectionData_t<span class="token operator">></span>          m_SectionData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span> ExportData_t<span class="token operator">></span> m_ExportData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span> ImportData_t<span class="token operator">></span>           m_ImportData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>IMAGE_DATA_DIRECTORY<span class="token operator">></span>   m_DirectoryData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        DebugData_t                            m_DebugData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        PIMAGE_DOS_HEADER        m_pDOSHeaders <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        PIMAGE_NT_HEADERS        m_pNTHeaders <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        bool                     m_bIsValidInternal <span class="token operator">=</span> false<span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t             m_nMismatchedArchitecture <span class="token operator">=</span> false<span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>
        <span class="token keyword">enum</span> PEHEADER_PARSING_TYPE <span class="token punctuation">:</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t
        <span class="token punctuation">{</span>
            TYPE_NONE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            TYPE_ALL <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            TYPE_EXPORT_DIRECTORY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            TYPE_IMPORT_DIRECTORY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            TYPE_DEBUG_DIRECTORY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            TYPE_SECTIONS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">// Default ctor</span>
        <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Parsing data out of this image's buffer.</span>
        <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_ImageSize<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Parsing data out of this image's process.</span>
        <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_CustomBaseAddress <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">// Ensure we found the target PE header.</span>
        bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get DOS header of PE image.</span>
        PIMAGE_DOS_HEADER <span class="token function">GetDOSHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get NT headers of PE image.</span>
        PIMAGE_NT_HEADERS <span class="token function">GetNTHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get specific data directory of PE image.</span>
        IMAGE_DATA_DIRECTORY <span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nDirIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get section data of PE image.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>SectionData_t<span class="token operator">></span> <span class="token function">GetSectionData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get exported functions' data of PE image.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span> ExportData_t<span class="token operator">></span> <span class="token function">GetExportData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get imported functions' data of PE image.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span> ImportData_t<span class="token operator">></span> <span class="token function">GetImportData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get debug directories' data of PE image.</span>
        DebugData_t <span class="token function">GetDebugData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Convert relative virtual address to file offset.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t <span class="token function">RvaToOffset</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nRva<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Convert file offset to relative virtual address.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t <span class="token function">OffsetToRva</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get certain section by address in memory.</span>
        SectionData_t <span class="token function">GetSectionByAddress</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// PE Image utility helpers</span>
    class ImageFile_t
    <span class="token punctuation">{</span>
        PEHeaderData_t m_PEHeaderData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true">// Used for parsing PE's from file.</span>
        <span class="token function">ImageFile_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szImagePath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Used for parsing PE's from memory.</span>
        <span class="token function">ImageFile_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nImageSize<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>
        ByteArray_t    m_ImageBuffer<span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true">// Ensure we found the target PE image.</span>
        bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get PE header data of PE image.</span>
        PEHeaderData_t <span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Writes data in local buffer to file.</span>
        <span class="token keyword">void</span> <span class="token function">WriteToFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Driver utility helpers</span>
    class Driver_t
    <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string m_szDriverPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        HANDLE m_hTargetDriverHandle <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">// Default ctor.</span>
        <span class="token function">Driver_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Initialize by driver path.</span>
        <span class="token function">Driver_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Initialize by driver information.</span>
        <span class="token function">Driver_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverName<span class="token punctuation">,</span> DWORD m_dDesiredAccess<span class="token punctuation">,</span> DWORD m_dSharedMode<span class="token punctuation">,</span> DWORD m_dCreationDisposition<span class="token punctuation">,</span> DWORD m_dFlagsAndAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true">// For opening an HANDLE to a currently loaded driver.</span>
        bool <span class="token function">SetupHandle</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverName<span class="token punctuation">,</span> DWORD m_dDesiredAccess<span class="token punctuation">,</span> DWORD m_dSharedMode<span class="token punctuation">,</span> DWORD m_dCreationDisposition<span class="token punctuation">,</span> DWORD m_dFlagsAndAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// For destroying a HANDLE to a currently loaded driver.</span>
        bool <span class="token function">DestroyHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Send IOCTL request to the target driver, returning the response.</span>
        DWORD <span class="token function">SendIOCTL</span><span class="token punctuation">(</span>DWORD m_dControlCode<span class="token punctuation">,</span> LPVOID m_pInBuffer<span class="token punctuation">,</span> DWORD m_dBufferSize<span class="token punctuation">,</span> LPVOID m_pOutBuffer<span class="token punctuation">,</span> DWORD m_dOutBufferSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Loads a target driver through the service manager. Obviously, these drivers must be SIGNED.</span>
        SC_HANDLE <span class="token function">LoadDriver</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverPaths<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Unloads a target driver that was previously loaded through the service manager.</span>
        <span class="token keyword">void</span> <span class="token function">UnloadDriver</span><span class="token punctuation">(</span><span class="token keyword">const</span> SC_HANDLE m_hLoadedStartedService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    class Module_t
    <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_dModuleBaseAddress <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t  m_dModuleSize <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        PEHeaderData_t m_PEHeaderData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>
        ByteArray_t m_ModuleData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Default ctor</span>
        <span class="token function">Module_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Setup module in process by (non-case sensitive) name. </span>
        <span class="token function">Module_t</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Setup module in process by address in process. (plz pass correct data here :D)</span>
        <span class="token function">Module_t</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_dModuleBaseAddress<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_dModuleSize<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ease of use for building constructors.</span>
        <span class="token keyword">void</span> <span class="token function">SetupModule_Internal</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true">// Helper function to get PE header data of target process.</span>
        PEHeaderData_t <span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get module data of target process.</span>
        ByteArray_t <span class="token function">GetModuleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ensure we found the target module in memory.</span>
        bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to find some bytes in the module data.</span>
        Address_t <span class="token function">FindIDASignature</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string_view m_szSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    class Thread_t
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Basic thread information.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_dThreadID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        HANDLE m_hThreadHandle <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Acts as a lock, to only resume threads previously suspended.</span>
        bool m_bIsThreadManuallySuspended <span class="token operator">=</span> false<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Acts as a lock, to only free HANDLE's that we've internally obtained.</span>
        bool m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> false<span class="token punctuation">;</span>

    public<span class="token punctuation">:</span>
        <span class="token keyword">enum</span> THREADINFOCLASS <span class="token punctuation">{</span>
            ThreadBasicInformation<span class="token punctuation">,</span>
            ThreadTimes<span class="token punctuation">,</span>
            ThreadPriority<span class="token punctuation">,</span>
            ThreadBasePriority<span class="token punctuation">,</span>
            ThreadAffinityMask<span class="token punctuation">,</span>
            ThreadImpersonationToken<span class="token punctuation">,</span>
            ThreadDescriptorTableEntry<span class="token punctuation">,</span>
            ThreadEnableAlignmentFaultFixup<span class="token punctuation">,</span>
            ThreadEventPair<span class="token punctuation">,</span>
            ThreadQuerySetWin32StartAddress<span class="token punctuation">,</span>
            ThreadZeroTlsCell<span class="token punctuation">,</span>
            ThreadPerformanceCount<span class="token punctuation">,</span>
            ThreadAmILastThread<span class="token punctuation">,</span>
            ThreadIdealProcessor<span class="token punctuation">,</span>
            ThreadPriorityBoost<span class="token punctuation">,</span>
            ThreadSetTlsArrayAddress<span class="token punctuation">,</span>
            ThreadIsIoPending<span class="token punctuation">,</span>
            ThreadHideFromDebugger
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">typedef</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> NtQueryInformationThread_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">,</span> THREADINFOCLASS<span class="token punctuation">,</span> PVOID<span class="token punctuation">,</span> ULONG<span class="token punctuation">,</span> PULONG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">// Default ctor</span>
        <span class="token function">Thread_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Initialize with TID.</span>
        <span class="token function">Thread_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_dThreadID<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Initialize with TID&amp;HANDLE.</span>
        <span class="token function">Thread_t</span><span class="token punctuation">(</span>HANDLE m_hThreadHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Default dtor</span>
        <span class="token operator">~</span><span class="token function">Thread_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Terminating a target thread.</span>
        <span class="token keyword">void</span> <span class="token function">Terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Suspending a target thread.</span>
        <span class="token keyword">void</span> <span class="token function">Suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Resuming a target thread.</span>
        <span class="token keyword">void</span> <span class="token function">Resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get context of this thread.</span>
        CONTEXT <span class="token function">GetThreadCTX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Set context of this thread.</span>
        <span class="token keyword">void</span> <span class="token function">SetThreadCTX</span><span class="token punctuation">(</span>CONTEXT m_Context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Check which module this thread is associated with.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">GetOwningModule</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> bool m_bUseCachedData <span class="token operator">=</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ensure we found a HANDLE to the target thread.</span>
        bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Is the target thread suspended?</span>
        bool <span class="token function">IsSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Did we suspend the target thread ourselves?</span>
        bool <span class="token function">IsManuallySuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get's the start address of a target thread.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t <span class="token function">GetStartAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Process utility helpers</span>
    class Process_t
    <span class="token punctuation">{</span>
    public<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">// Default ctor</span>
        <span class="token function">Process_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Get target proces by name.</span>
        <span class="token function">Process_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> wchar_t<span class="token operator">*</span> m_wszProcessName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">,</span> DWORD m_dDesiredAccess <span class="token operator">=</span> PROCESS_ALL_ACCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get target proces by PID.</span>
        <span class="token function">Process_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nProcessID<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">,</span> DWORD m_dDesiredAccess <span class="token operator">=</span> PROCESS_ALL_ACCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get target proces by HANDLE.</span>
        <span class="token function">Process_t</span><span class="token punctuation">(</span>HANDLE m_hProcessHandle<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Default dtor</span>
        <span class="token operator">~</span><span class="token function">Process_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">enum</span> eManualMapInjectionFlags <span class="token punctuation">:</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t
        <span class="token punctuation">{</span>
            INJECTION_NONE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_MODE_THREADHIJACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_MODE_CREATEREMOTETHREAD <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_EXTRA_CUSTOMARGUMENTS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_EXTRA_WIPEPEHEADERS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_EXTRA_WIPEENTRYPOINT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_EXTRA_WIPEGARBAGESECTIONS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            INJECTION_MAXIMUM <span class="token operator">=</span> INJECTION_EXTRA_WIPEGARBAGESECTIONS <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">enum</span> class eProcessArchitecture <span class="token punctuation">:</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t
        <span class="token punctuation">{</span>
            ARCHITECTURE_UNKNOWN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ARCHITECTURE_x64 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ARCHITECTURE_x86 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ARCHITECTURE_MAXIMUM <span class="token operator">=</span> ARCHITECTURE_x86 <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

    private<span class="token punctuation">:</span>
        PEHeaderData_t m_PEHeaderData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Basic process information.</span>
        HANDLE m_hTargetProcessHandle <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t  m_nTargetProcessID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// For saving off this processes' architecture type.</span>
        eProcessArchitecture m_eProcessArchitecture <span class="token operator">=</span> eProcessArchitecture<span class="token punctuation">:</span><span class="token punctuation">:</span>ARCHITECTURE_UNKNOWN<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// For saving off this processes' name.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string m_szProcessName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// For saving off this processes' filesystem path.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string m_szProcessPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Acts as a lock, to only resume threads previously suspended.</span>
        bool m_bIsProcessManuallySuspended <span class="token operator">=</span> false<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Acts as a lock, to only free HANDLE's that we've internally obtained.</span>
        bool m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> false<span class="token punctuation">;</span>

        <span class="token keyword">enum</span> PROCESSINFOCLASS
        <span class="token punctuation">{</span>
            ProcessBasicInformation <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>
            ProcessQuotaLimits <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">,</span>
            ProcessIoCounters <span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">,</span>
            ProcessVmCounters <span class="token operator">=</span> <span class="token number">0x03</span><span class="token punctuation">,</span>
            ProcessTimes <span class="token operator">=</span> <span class="token number">0x04</span><span class="token punctuation">,</span>
            ProcessBasePriority <span class="token operator">=</span> <span class="token number">0x05</span><span class="token punctuation">,</span>
            ProcessRaisePriority <span class="token operator">=</span> <span class="token number">0x06</span><span class="token punctuation">,</span>
            ProcessDebugPort <span class="token operator">=</span> <span class="token number">0x07</span><span class="token punctuation">,</span>
            ProcessExceptionPort <span class="token operator">=</span> <span class="token number">0x08</span><span class="token punctuation">,</span>
            ProcessAccessToken <span class="token operator">=</span> <span class="token number">0x09</span><span class="token punctuation">,</span>
            ProcessLdtInformation <span class="token operator">=</span> <span class="token number">0x0A</span><span class="token punctuation">,</span>
            ProcessLdtSize <span class="token operator">=</span> <span class="token number">0x0B</span><span class="token punctuation">,</span>
            ProcessDefaultHardErrorMode <span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">,</span>
            ProcessIoPortHandlers <span class="token operator">=</span> <span class="token number">0x0D</span><span class="token punctuation">,</span>
            ProcessPooledUsageAndLimits <span class="token operator">=</span> <span class="token number">0x0E</span><span class="token punctuation">,</span>
            ProcessWorkingSetWatch <span class="token operator">=</span> <span class="token number">0x0F</span><span class="token punctuation">,</span>
            ProcessUserModeIOPL <span class="token operator">=</span> <span class="token number">0x10</span><span class="token punctuation">,</span>
            ProcessEnableAlignmentFaultFixup <span class="token operator">=</span> <span class="token number">0x11</span><span class="token punctuation">,</span>
            ProcessPriorityClass <span class="token operator">=</span> <span class="token number">0x12</span><span class="token punctuation">,</span>
            ProcessWx86Information <span class="token operator">=</span> <span class="token number">0x13</span><span class="token punctuation">,</span>
            ProcessHandleCount <span class="token operator">=</span> <span class="token number">0x14</span><span class="token punctuation">,</span>
            ProcessAffinityMask <span class="token operator">=</span> <span class="token number">0x15</span><span class="token punctuation">,</span>
            ProcessPriorityBoost <span class="token operator">=</span> <span class="token number">0x16</span><span class="token punctuation">,</span>
            ProcessDeviceMap <span class="token operator">=</span> <span class="token number">0x17</span><span class="token punctuation">,</span>
            ProcessSessionInformation <span class="token operator">=</span> <span class="token number">0x18</span><span class="token punctuation">,</span>
            ProcessForegroundInformation <span class="token operator">=</span> <span class="token number">0x19</span><span class="token punctuation">,</span>
            ProcessWow64Information <span class="token operator">=</span> <span class="token number">0x1A</span><span class="token punctuation">,</span>
            ProcessImageFileName <span class="token operator">=</span> <span class="token number">0x1B</span><span class="token punctuation">,</span>
            ProcessLUIDDeviceMapsEnabled <span class="token operator">=</span> <span class="token number">0x1C</span><span class="token punctuation">,</span>
            ProcessBreakOnTermination <span class="token operator">=</span> <span class="token number">0x1D</span><span class="token punctuation">,</span>
            ProcessDebugObjectHandle <span class="token operator">=</span> <span class="token number">0x1E</span><span class="token punctuation">,</span>
            ProcessDebugFlags <span class="token operator">=</span> <span class="token number">0x1F</span><span class="token punctuation">,</span>
            ProcessHandleTracing <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">,</span>
            ProcessIoPriority <span class="token operator">=</span> <span class="token number">0x21</span><span class="token punctuation">,</span>
            ProcessExecuteFlags <span class="token operator">=</span> <span class="token number">0x22</span><span class="token punctuation">,</span>
            ProcessResourceManagement <span class="token operator">=</span> <span class="token number">0x23</span><span class="token punctuation">,</span>
            ProcessCookie <span class="token operator">=</span> <span class="token number">0x24</span><span class="token punctuation">,</span>
            ProcessImageInformation <span class="token operator">=</span> <span class="token number">0x25</span><span class="token punctuation">,</span>
            ProcessCycleTime <span class="token operator">=</span> <span class="token number">0x26</span><span class="token punctuation">,</span>
            ProcessPagePriority <span class="token operator">=</span> <span class="token number">0x27</span><span class="token punctuation">,</span>
            ProcessInstrumentationCallback <span class="token operator">=</span> <span class="token number">0x28</span><span class="token punctuation">,</span>
            ProcessThreadStackAllocation <span class="token operator">=</span> <span class="token number">0x29</span><span class="token punctuation">,</span>
            ProcessWorkingSetWatchEx <span class="token operator">=</span> <span class="token number">0x2A</span><span class="token punctuation">,</span>
            ProcessImageFileNameWin32 <span class="token operator">=</span> <span class="token number">0x2B</span><span class="token punctuation">,</span>
            ProcessImageFileMapping <span class="token operator">=</span> <span class="token number">0x2C</span><span class="token punctuation">,</span>
            ProcessAffinityUpdateMode <span class="token operator">=</span> <span class="token number">0x2D</span><span class="token punctuation">,</span>
            ProcessMemoryAllocationMode <span class="token operator">=</span> <span class="token number">0x2E</span><span class="token punctuation">,</span>
            ProcessGroupInformation <span class="token operator">=</span> <span class="token number">0x2F</span><span class="token punctuation">,</span>
            ProcessTokenVirtualizationEnabled <span class="token operator">=</span> <span class="token number">0x30</span><span class="token punctuation">,</span>
            ProcessConsoleHostProcess <span class="token operator">=</span> <span class="token number">0x31</span><span class="token punctuation">,</span>
            ProcessWindowInformation <span class="token operator">=</span> <span class="token number">0x32</span><span class="token punctuation">,</span>
            ProcessHandleInformation <span class="token operator">=</span> <span class="token number">0x33</span><span class="token punctuation">,</span>
            ProcessMitigationPolicy <span class="token operator">=</span> <span class="token number">0x34</span><span class="token punctuation">,</span>
            ProcessDynamicFunctionTableInformation <span class="token operator">=</span> <span class="token number">0x35</span><span class="token punctuation">,</span>
            ProcessHandleCheckingMode <span class="token operator">=</span> <span class="token number">0x36</span><span class="token punctuation">,</span>
            ProcessKeepAliveCount <span class="token operator">=</span> <span class="token number">0x37</span><span class="token punctuation">,</span>
            ProcessRevokeFileHandles <span class="token operator">=</span> <span class="token number">0x38</span><span class="token punctuation">,</span>
            ProcessWorkingSetControl <span class="token operator">=</span> <span class="token number">0x39</span><span class="token punctuation">,</span>
            ProcessHandleTable <span class="token operator">=</span> <span class="token number">0x3A</span><span class="token punctuation">,</span>
            ProcessCheckStackExtentsMode <span class="token operator">=</span> <span class="token number">0x3B</span><span class="token punctuation">,</span>
            ProcessCommandLineInformation <span class="token operator">=</span> <span class="token number">0x3C</span><span class="token punctuation">,</span>
            ProcessProtectionInformation <span class="token operator">=</span> <span class="token number">0x3D</span><span class="token punctuation">,</span>
            ProcessMemoryExhaustion <span class="token operator">=</span> <span class="token number">0x3E</span><span class="token punctuation">,</span>
            ProcessFaultInformation <span class="token operator">=</span> <span class="token number">0x3F</span><span class="token punctuation">,</span>
            ProcessTelemetryIdInformation <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">,</span>
            ProcessCommitReleaseInformation <span class="token operator">=</span> <span class="token number">0x41</span><span class="token punctuation">,</span>
            ProcessDefaultCpuSetsInformation <span class="token operator">=</span> <span class="token number">0x42</span><span class="token punctuation">,</span>
            ProcessAllowedCpuSetsInformation <span class="token operator">=</span> <span class="token number">0x43</span><span class="token punctuation">,</span>
            ProcessSubsystemProcess <span class="token operator">=</span> <span class="token number">0x44</span><span class="token punctuation">,</span>
            ProcessJobMemoryInformation <span class="token operator">=</span> <span class="token number">0x45</span><span class="token punctuation">,</span>
            ProcessInPrivate <span class="token operator">=</span> <span class="token number">0x46</span><span class="token punctuation">,</span>
            ProcessRaiseUMExceptionOnInvalidHandleClose <span class="token operator">=</span> <span class="token number">0x47</span><span class="token punctuation">,</span>
            ProcessIumChallengeResponse <span class="token operator">=</span> <span class="token number">0x48</span><span class="token punctuation">,</span>
            ProcessChildProcessInformation <span class="token operator">=</span> <span class="token number">0x49</span><span class="token punctuation">,</span>
            ProcessHighGraphicsPriorityInformation <span class="token operator">=</span> <span class="token number">0x4A</span><span class="token punctuation">,</span>
            ProcessSubsystemInformation <span class="token operator">=</span> <span class="token number">0x4B</span><span class="token punctuation">,</span>
            ProcessEnergyValues <span class="token operator">=</span> <span class="token number">0x4C</span><span class="token punctuation">,</span>
            ProcessActivityThrottleState <span class="token operator">=</span> <span class="token number">0x4D</span><span class="token punctuation">,</span>
            ProcessActivityThrottlePolicy <span class="token operator">=</span> <span class="token number">0x4E</span><span class="token punctuation">,</span>
            ProcessWin32kSyscallFilterInformation <span class="token operator">=</span> <span class="token number">0x4F</span><span class="token punctuation">,</span>
            ProcessDisableSystemAllowedCpuSets <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">,</span>
            ProcessWakeInformation <span class="token operator">=</span> <span class="token number">0x51</span><span class="token punctuation">,</span>
            ProcessEnergyTrackingState <span class="token operator">=</span> <span class="token number">0x52</span><span class="token punctuation">,</span>
            ProcessManageWritesToExecutableMemory <span class="token operator">=</span> <span class="token number">0x53</span><span class="token punctuation">,</span>
            ProcessCaptureTrustletLiveDump <span class="token operator">=</span> <span class="token number">0x54</span><span class="token punctuation">,</span>
            ProcessTelemetryCoverage <span class="token operator">=</span> <span class="token number">0x55</span><span class="token punctuation">,</span>
            ProcessEnclaveInformation <span class="token operator">=</span> <span class="token number">0x56</span><span class="token punctuation">,</span>
            ProcessEnableReadWriteVmLogging <span class="token operator">=</span> <span class="token number">0x57</span><span class="token punctuation">,</span>
            ProcessUptimeInformation <span class="token operator">=</span> <span class="token number">0x58</span><span class="token punctuation">,</span>
            ProcessImageSection <span class="token operator">=</span> <span class="token number">0x59</span><span class="token punctuation">,</span>
            ProcessDebugAuthInformation <span class="token operator">=</span> <span class="token number">0x5A</span><span class="token punctuation">,</span>
            ProcessSystemResourceManagement <span class="token operator">=</span> <span class="token number">0x5B</span><span class="token punctuation">,</span>
            ProcessSequenceNumber <span class="token operator">=</span> <span class="token number">0x5C</span><span class="token punctuation">,</span>
            ProcessLoaderDetour <span class="token operator">=</span> <span class="token number">0x5D</span><span class="token punctuation">,</span>
            ProcessSecurityDomainInformation <span class="token operator">=</span> <span class="token number">0x5E</span><span class="token punctuation">,</span>
            ProcessCombineSecurityDomainsInformation <span class="token operator">=</span> <span class="token number">0x5F</span><span class="token punctuation">,</span>
            ProcessEnableLogging <span class="token operator">=</span> <span class="token number">0x60</span><span class="token punctuation">,</span>
            ProcessLeapSecondInformation <span class="token operator">=</span> <span class="token number">0x61</span><span class="token punctuation">,</span>
            ProcessFiberShadowStackAllocation <span class="token operator">=</span> <span class="token number">0x62</span><span class="token punctuation">,</span>
            ProcessFreeFiberShadowStackAllocation <span class="token operator">=</span> <span class="token number">0x63</span><span class="token punctuation">,</span>
            MaxProcessInfoClass <span class="token operator">=</span> <span class="token number">0x64</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">typedef</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> NtSuspendProcess_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">typedef</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> NtResumeProcess_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">typedef</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> NtQueryInformationProcess_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">,</span> PROCESSINFOCLASS<span class="token punctuation">,</span> PVOID<span class="token punctuation">,</span> ULONG<span class="token punctuation">,</span> PULONG<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Relevant information pertaining a target thread.</span>
        <span class="token keyword">struct</span> ThreadInformation_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_nThreadID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t        m_nThreadStartAddress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            bool                m_bIsThreadSuspended <span class="token operator">=</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Relevant information pertaining a target module.</span>
        <span class="token keyword">struct</span> ModuleInformation_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string    m_szName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string       m_szPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t  m_nSize <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_BaseAddress <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">struct</span> AllocatedMemoryData_t
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_AllocatedAddress <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nAllocatedSize <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Caching all loaded modules in target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>ModuleInformation_t<span class="token operator">></span> m_EnumeratedModulesCached <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Track allocated memory (removed on ::VirtualFreeEx calls).</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t<span class="token operator">></span> m_AllocatedMemoryTracker<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Keep track of modules already initialized.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>unordered_map<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">,</span> Module_t<span class="token operator">></span> m_AllocatedModules<span class="token punctuation">;</span>

        bool m_bHasCachedProcessesModules <span class="token operator">=</span> false<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get architecture of target process. </span>
        eProcessArchitecture <span class="token function">GetProcessArchitecture_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get name of target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">GetProcessName_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get filesystem path of target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">GetProcessPath_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Internal manual map function.</span>
        bool <span class="token function">ManualMapInject_Internal</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span>  std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags <span class="token operator">=</span> eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true">// Helper function to get architecture of target process. </span>
        eProcessArchitecture <span class="token function">GetProcessArchitecture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get PE header data of target process.</span>
        PEHeaderData_t <span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get filesystem path of target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">GetPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Helper function to get name of target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// The base address of the target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t <span class="token function">GetBaseAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// The process ID of the target process. (lol)</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t <span class="token function">GetProcessID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// The PEB of the target process.</span>
        PEB <span class="token function">GetPEB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ensure we found a HANDLE to the target process.</span>
        bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Is target process 32-bit running on 64-bit OS?</span>
        bool <span class="token function">IsWow64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Did we suspend the target process ourselves?</span>
        bool <span class="token function">IsManuallySuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Is the target process suspended?</span>
        bool <span class="token function">IsSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Is the target process running under a debugger?</span>
        bool <span class="token function">IsBeingDebugged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Manual map injection from module on disk.</span>
        bool <span class="token function">ManualMapInject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDLLPath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags <span class="token operator">=</span> eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Manual map injection from module in memory.</span>
        bool <span class="token function">ManualMapInject</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags <span class="token operator">=</span> eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Manual map injection from ImageFile_t.</span>
        bool <span class="token function">ManualMapInject</span><span class="token punctuation">(</span>ImageFile_t<span class="token operator">&amp;</span> m_ImageFile<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags <span class="token operator">=</span> eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// LoadLibrary injection from module on disk.</span>
        bool <span class="token function">LoadLibraryInject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDLLPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Traverse and cache data about all threads in a target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>ThreadInformation_t<span class="token operator">></span> <span class="token function">EnumerateThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Traverse and cache data about all loaded modules in a target process.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>ModuleInformation_t<span class="token operator">></span> <span class="token function">EnumerateModules</span><span class="token punctuation">(</span>bool m_bUseCachedData <span class="token operator">=</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Sets debug privileges of a target process.</span>
        bool <span class="token function">SetDebugPrivilege</span><span class="token punctuation">(</span>bool m_bShouldEnable<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Suspend every thread in a target process.</span>
        <span class="token keyword">void</span> <span class="token function">Suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Resume every previously suspended thread in a target process.</span>
        <span class="token keyword">void</span> <span class="token function">Resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get desired export address by name.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t <span class="token function">GetRemoteProcAddress</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szExportName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// ReadProcessMemory implementation.</span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> T <span class="token function">Read</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_ReadAddress<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            T m_pOutputRead<span class="token punctuation">;</span>
            <span class="token function">ReadProcessMemory</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCVOID<span class="token punctuation">)</span>m_ReadAddress<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_pOutputRead<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span> nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> m_pOutputRead<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// ReadProcessMemory implementation - allows byte arrays.</span>
        template <span class="token operator">&lt;</span>typename S<span class="token operator">></span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t <span class="token function">Read</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_ReadAddress<span class="token punctuation">,</span> S m_pBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nBufferSize<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            SIZE_T m_nBytesRead <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
            <span class="token function">ReadProcessMemory</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCVOID<span class="token punctuation">)</span>m_ReadAddress<span class="token punctuation">,</span> m_pBuffer<span class="token punctuation">,</span> m_nBufferSize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_nBytesRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> m_nBytesRead<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// WriteProcessMemory implementation.</span>
        template <span class="token operator">&lt;</span>typename S<span class="token operator">></span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t <span class="token function">Write</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_WriteAddress<span class="token punctuation">,</span> S m_WriteValue<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            SIZE_T lpNumberOfBytesWritten <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Fuck you MSVC.</span>
            <span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span>m_WriteAddress<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCVOID<span class="token punctuation">)</span>m_WriteValue<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>lpNumberOfBytesWritten<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> lpNumberOfBytesWritten<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// WriteProcessMemory implementation.</span>
        template <span class="token operator">&lt;</span>typename S<span class="token operator">></span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t <span class="token function">Write</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_WriteAddress<span class="token punctuation">,</span> S m_WriteValue<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_WriteSize<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            SIZE_T lpNumberOfBytesWritten <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Fuck you MSVC.</span>
            <span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span>m_WriteAddress<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCVOID<span class="token punctuation">)</span>m_WriteValue<span class="token punctuation">,</span> m_WriteSize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lpNumberOfBytesWritten<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> lpNumberOfBytesWritten<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// VirtualAllocEx implementation.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t <span class="token function">Allocate</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_AllocationSize<span class="token punctuation">,</span> DWORD m_dProtectionType<span class="token punctuation">,</span> bool m_bShouldTrack <span class="token operator">=</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// VirtualFreeEx implementation.</span>
        bool <span class="token function">Free</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_FreeAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// VirtualQueryEx implementation.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t <span class="token function">Query</span><span class="token punctuation">(</span>LPCVOID m_QueryAddress<span class="token punctuation">,</span> MEMORY_BASIC_INFORMATION<span class="token operator">*</span> m_MemoryInformation<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// _CreateRemoteThread implementation.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t <span class="token function">_CreateRemoteThread</span><span class="token punctuation">(</span>LPVOID m_lpStartAddress<span class="token punctuation">,</span> LPVOID m_lpParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// GetModule implementation.</span>
        Module_t<span class="token operator">&amp;</span> <span class="token function">GetModule</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType <span class="token operator">=</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Address helper class</span>
    class Address_t 
    <span class="token punctuation">{</span>
    private<span class="token punctuation">:</span>
        uintptr_t m_dAddress <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    public<span class="token punctuation">:</span>
        <span class="token function">Address_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Templated ctor.</span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> <span class="token function">Address_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> T m_Address<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            m_dAddress <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_Address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Operator.</span>
        bool operator<span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Address_t<span class="token operator">&amp;</span> m_Address<span class="token punctuation">)</span> <span class="token keyword">const</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> m_dAddress <span class="token operator">==</span> m_Address<span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Operator.</span>
        bool operator<span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Address_t<span class="token operator">&amp;</span> m_Address<span class="token punctuation">)</span> <span class="token keyword">const</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> m_dAddress <span class="token operator">!=</span> m_Address<span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Getter.</span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> T <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> m_dAddress <span class="token operator">?</span> <span class="token function">T</span><span class="token punctuation">(</span>m_dAddress<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Dereferences one time and casts.</span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> T<span class="token operator">&amp;</span> <span class="token function">To</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">*</span>CH_R_CAST<span class="token operator">&lt;</span>T<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_dAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Offset current address. </span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> T <span class="token function">Offset</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>ptrdiff_t m_Offset<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> m_dAddress <span class="token operator">?</span> CH_R_CAST<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>m_dAddress <span class="token operator">+</span> m_Offset<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Dereferences address X times.</span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> T <span class="token function">Deref</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nCount<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_dAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Invalid address called @Address_t::Deref."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_Address <span class="token operator">=</span> m_dAddress<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>m_nCount<span class="token operator">--</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_Address<span class="token punctuation">)</span>
                    m_Address <span class="token operator">=</span> <span class="token operator">*</span>CH_R_CAST<span class="token operator">&lt;</span>uintptr_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_Address<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>m_Address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Follows relative jmp. - E8 </span>
        template <span class="token operator">&lt;</span>class T<span class="token operator">></span> T <span class="token function">Relative</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>ptrdiff_t m_Offset<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_dAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Invalid address called @Address_t::Relative."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_Address <span class="token operator">=</span> m_dAddress <span class="token operator">+</span> m_Offset<span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>ptrdiff_t m_RelativeOffset <span class="token operator">=</span> <span class="token operator">*</span>CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>ptrdiff_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_Address<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_RelativeOffset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Invalid relative offset @Address_t::Relative."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>m_Address <span class="token operator">+</span> m_RelativeOffset <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    namespace math
    <span class="token punctuation">{</span>
        class Color
        <span class="token punctuation">{</span>
        public<span class="token punctuation">:</span>
            <span class="token keyword">float</span> r <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> g <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> b <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> a <span class="token operator">=</span> <span class="token number">255.0f</span><span class="token punctuation">;</span>
        public<span class="token punctuation">:</span>
            <span class="token function">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> r<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> g<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> b<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
            <span class="token function">Color</span><span class="token punctuation">(</span><span class="token keyword">float</span> _r<span class="token punctuation">,</span> <span class="token keyword">float</span> _g<span class="token punctuation">,</span> <span class="token keyword">float</span> _b<span class="token punctuation">,</span> <span class="token keyword">float</span> _a<span class="token punctuation">)</span> <span class="token punctuation">:</span> r<span class="token punctuation">{</span> _r <span class="token punctuation">}</span><span class="token punctuation">,</span> g<span class="token punctuation">{</span> _g <span class="token punctuation">}</span><span class="token punctuation">,</span> b<span class="token punctuation">{</span> _b <span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">{</span> _a <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

            bool operator<span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Color<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>r <span class="token operator">==</span> this<span class="token operator">-></span>r <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>g <span class="token operator">==</span> this<span class="token operator">-></span>g <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>b <span class="token operator">==</span> this<span class="token operator">-></span>b <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>a <span class="token operator">==</span> this<span class="token operator">-></span>a<span class="token punctuation">;</span> <span class="token punctuation">}</span>
            bool operator<span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Color<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>r <span class="token operator">!=</span> this<span class="token operator">-></span>r <span class="token operator">||</span> v<span class="token punctuation">.</span>g <span class="token operator">!=</span> this<span class="token operator">-></span>g <span class="token operator">||</span> v<span class="token punctuation">.</span>b <span class="token operator">!=</span> this<span class="token operator">-></span>b <span class="token operator">||</span> v<span class="token punctuation">.</span>a <span class="token operator">!=</span> this<span class="token operator">-></span>a<span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token keyword">void</span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token keyword">float</span> _r <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token keyword">float</span> _g <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token keyword">float</span> _b <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token keyword">float</span> _a <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>r <span class="token operator">=</span> _r<span class="token punctuation">;</span> this<span class="token operator">-></span>g <span class="token operator">=</span> _g<span class="token punctuation">;</span> this<span class="token operator">-></span>b <span class="token operator">=</span> _b<span class="token punctuation">;</span> this<span class="token operator">-></span>a <span class="token operator">=</span> _a<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        class Vector2D
        <span class="token punctuation">{</span>
        public<span class="token punctuation">:</span>
            <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        public<span class="token punctuation">:</span>
            <span class="token function">Vector2D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> x<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
            <span class="token function">Vector2D</span><span class="token punctuation">(</span><span class="token keyword">int</span> _x<span class="token punctuation">,</span> <span class="token keyword">int</span> _y<span class="token punctuation">)</span> <span class="token punctuation">:</span> x<span class="token punctuation">{</span> _x <span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token punctuation">{</span> _y <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

            bool operator<span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>x <span class="token operator">==</span> this<span class="token operator">-></span>x <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>y <span class="token operator">==</span> this<span class="token operator">-></span>y<span class="token punctuation">;</span> <span class="token punctuation">}</span>
            bool operator<span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>x <span class="token operator">!=</span> this<span class="token operator">-></span>x <span class="token operator">||</span> v<span class="token punctuation">.</span>y <span class="token operator">!=</span> this<span class="token operator">-></span>y<span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// TODO: more arithmetic operators, too lazy to type it all out rn.</span>
            Vector2D operator<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">-</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">-</span> v<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector2D operator<span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">+</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">+</span> v<span class="token punctuation">.</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector2D operator<span class="token operator">-</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">-</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">-</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector2D operator<span class="token operator">+</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">+</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">+</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector2D operator<span class="token operator">/</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">/</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">/</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector2D operator<span class="token operator">*</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">*</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">*</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token keyword">void</span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token keyword">int</span> _x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> _y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">=</span> _x<span class="token punctuation">;</span> this<span class="token operator">-></span>y <span class="token operator">=</span> _y<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        class Vector3D
        <span class="token punctuation">{</span>
        public<span class="token punctuation">:</span>
            <span class="token keyword">float</span> x <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> y <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> z <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
        public<span class="token punctuation">:</span>
            <span class="token function">Vector3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> x<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> z<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
            <span class="token function">Vector3D</span><span class="token punctuation">(</span><span class="token keyword">float</span> _x<span class="token punctuation">,</span> <span class="token keyword">float</span> _y<span class="token punctuation">,</span> <span class="token keyword">float</span> _z<span class="token punctuation">)</span> <span class="token punctuation">:</span> x<span class="token punctuation">{</span> _x <span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token punctuation">{</span> _y <span class="token punctuation">}</span><span class="token punctuation">,</span> z<span class="token punctuation">{</span> _z <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

            bool operator<span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>x <span class="token operator">==</span> this<span class="token operator">-></span>x <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>y <span class="token operator">==</span> this<span class="token operator">-></span>y <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>z <span class="token operator">==</span> this<span class="token operator">-></span>z<span class="token punctuation">;</span> <span class="token punctuation">}</span>
            bool operator<span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>x <span class="token operator">!=</span> this<span class="token operator">-></span>x <span class="token operator">||</span> v<span class="token punctuation">.</span>y <span class="token operator">!=</span> this<span class="token operator">-></span>y <span class="token operator">||</span> v<span class="token punctuation">.</span>z <span class="token operator">!=</span> this<span class="token operator">-></span>z<span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// TODO: more arithmetic operators, too lazy to type it all out rn.</span>
            Vector3D operator<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">-</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">-</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token operator">-></span>z <span class="token operator">-</span> v<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector3D operator<span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">+</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">+</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span>  this<span class="token operator">-></span>z <span class="token operator">+</span> v<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector3D operator<span class="token operator">-</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">-</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">-</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token operator">-></span>z <span class="token operator">-</span><span class="token operator">=</span> v<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector3D operator<span class="token operator">+</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">+</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">+</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token operator">-></span>z <span class="token operator">+</span><span class="token operator">=</span> v<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector3D operator<span class="token operator">/</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">/</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">/</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token operator">-></span>z <span class="token operator">/</span><span class="token operator">=</span> v<span class="token punctuation">.</span>z  <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            Vector3D operator<span class="token operator">*</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">*</span><span class="token operator">=</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">*</span><span class="token operator">=</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token operator">-></span>z <span class="token operator">*</span><span class="token operator">=</span> v<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

            bool <span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> this<span class="token operator">-></span>x <span class="token operator">!=</span> <span class="token number">0.0f</span> <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>y <span class="token operator">!=</span> <span class="token number">0.0f</span> <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>z <span class="token operator">!=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">void</span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token keyword">float</span> _x <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token keyword">float</span> _y <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token keyword">float</span> _z <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">=</span> _x<span class="token punctuation">;</span> this<span class="token operator">-></span>y <span class="token operator">=</span> _y<span class="token punctuation">;</span> this<span class="token operator">-></span>z <span class="token operator">=</span> _z<span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token keyword">float</span> <span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">sqrtf</span><span class="token punctuation">(</span>this<span class="token operator">-></span><span class="token function">LengthSqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">float</span> <span class="token function">LengthSqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>x <span class="token operator">*</span> this<span class="token operator">-></span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>y <span class="token operator">*</span> this<span class="token operator">-></span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>z <span class="token operator">*</span> this<span class="token operator">-></span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>
            <span class="token keyword">float</span> <span class="token function">Length2DSqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>x <span class="token operator">*</span> this<span class="token operator">-></span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>y <span class="token operator">*</span> this<span class="token operator">-></span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">float</span> <span class="token function">Length2D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">sqrtf</span><span class="token punctuation">(</span>this<span class="token operator">-></span>x <span class="token operator">*</span> this<span class="token operator">-></span>x <span class="token operator">+</span> this<span class="token operator">-></span>y <span class="token operator">*</span> this<span class="token operator">-></span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">float</span> <span class="token function">Distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3D<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> Vector3D m_vecDelta <span class="token operator">=</span> <span class="token punctuation">{</span> this<span class="token operator">-></span>x <span class="token operator">-</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token operator">-></span>y <span class="token operator">-</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token operator">-></span>z <span class="token operator">-</span> v<span class="token punctuation">.</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">return</span> m_vecDelta<span class="token punctuation">.</span><span class="token function">Length2D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>cpp文件</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"chdr.h"</span></span>

<span class="token comment" spellcheck="true">// Process_t definitions and functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Get target proces by name.</span>
    Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Process_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> wchar_t<span class="token operator">*</span> m_wszProcessName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">,</span> DWORD m_dDesiredAccess<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        HANDLE m_hSnapShot <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span>TH32CS_SNAPPROCESS<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        PROCESSENTRY32 entry <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        entry<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">Process32Next</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">,</span> <span class="token operator">&amp;</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">wcscmp</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>szExeFile<span class="token punctuation">,</span> m_wszProcessName<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            this<span class="token operator">-></span>m_nTargetProcessID <span class="token operator">=</span> entry<span class="token punctuation">.</span>th32ProcessID<span class="token punctuation">;</span>
            this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>m_dDesiredAccess<span class="token punctuation">,</span> false<span class="token punctuation">,</span> this<span class="token operator">-></span>m_nTargetProcessID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span>
            <span class="token string">"Couldn't obtain valid HANDLE for process %ws"</span><span class="token punctuation">,</span> m_wszProcessName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_eProcessArchitecture <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessArchitecture_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_szProcessPath <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessPath_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_szProcessName <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessName_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_PEHeaderData <span class="token operator">=</span> <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span><span class="token operator">*</span>this<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get target proces by PID.</span>
    Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Process_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nProcessID<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">,</span> DWORD m_dDesiredAccess<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_nTargetProcessID <span class="token operator">=</span> m_nProcessID<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>m_dDesiredAccess<span class="token punctuation">,</span> false<span class="token punctuation">,</span> this<span class="token operator">-></span>m_nTargetProcessID<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span>
            <span class="token string">"Couldn't obtain valid HANDLE for PID %i"</span><span class="token punctuation">,</span> m_nProcessID<span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_eProcessArchitecture <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessArchitecture_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_szProcessPath <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessPath_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_szProcessName <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessName_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_PEHeaderData <span class="token operator">=</span> <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span><span class="token operator">*</span>this<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get target proces by HANDLE.</span>
    Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Process_t</span><span class="token punctuation">(</span>HANDLE m_hProcessHandle<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">=</span> m_hProcessHandle<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_nTargetProcessID <span class="token operator">=</span> <span class="token function">GetProcessId</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_eProcessArchitecture <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessArchitecture_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_szProcessPath <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessPath_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_szProcessName <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetProcessName_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_PEHeaderData <span class="token operator">=</span> <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span><span class="token operator">*</span>this<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Default dtor</span>
    Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token function">Process_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Just to be safe, free all of our allocated memory from this process.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> ForgottenMemory <span class="token punctuation">:</span> this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token operator">-></span><span class="token function">Free</span><span class="token punctuation">(</span>ForgottenMemory<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Has to be this ugly since I've included string enc in the log macros... :(</span>
                    <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Successful free of memory at 0x%X with size 0x%X"</span><span class="token punctuation">,</span> ForgottenMemory<span class="token punctuation">.</span>first<span class="token punctuation">,</span> ForgottenMemory<span class="token punctuation">.</span>second<span class="token punctuation">)</span>
                <span class="token keyword">else</span>
                    <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't free memory at 0x%X with size 0x%X"</span><span class="token punctuation">,</span> ForgottenMemory<span class="token punctuation">.</span>first<span class="token punctuation">,</span> ForgottenMemory<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Not allowed to release this HANDLE, or was already released.</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span>
            this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">&amp;&amp;</span>
            this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span>
            this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span>
            <span class="token string">"adawdasd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>m_hTargetProcessHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// The process ID of the target process. (lol)</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetProcessID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_nTargetProcessID<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Ensure we found a HANDLE to the target process.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetProcessHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Is this process 32-bit running on 64-bit OS?</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsWow64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        BOOL m_bIsWow64 <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
        <span class="token function">IsWow64Process</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_bIsWow64<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> m_bIsWow64<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get name of target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>string Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetProcessName_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        TCHAR m_szProcessNameBuffer<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetModuleBaseName</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> m_szProcessNameBuffer<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>

        m_szProcessNameBuffer<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// TCHAR->string</span>
        _bstr_t <span class="token function">m_szPreProcessName</span><span class="token punctuation">(</span>m_szProcessNameBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">string</span><span class="token punctuation">(</span>m_szPreProcessName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// The base address of the target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetBaseAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> CurrentModule <span class="token punctuation">:</span> this<span class="token operator">-></span><span class="token function">EnumerateModules</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">strcmp</span><span class="token punctuation">(</span>CurrentModule<span class="token punctuation">.</span>m_szName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> this<span class="token operator">-></span>m_szProcessName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> CurrentModule<span class="token punctuation">.</span>m_BaseAddress<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get name of target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>string Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_szProcessName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get filesystem path of target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>string Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetProcessPath_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        TCHAR m_szProcessPathBuffer<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetModuleFileNameEx</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> m_szProcessPathBuffer<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>

        m_szProcessPathBuffer<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// TCHAR->string</span>
        _bstr_t <span class="token function">m_szPreProcessPath</span><span class="token punctuation">(</span>m_szProcessPathBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">string</span><span class="token punctuation">(</span>m_szPreProcessPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get filesystem path of target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>string Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_szProcessPath<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get architecture of target process.</span>
    Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>eProcessArchitecture Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetProcessArchitecture_Internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        SYSTEM_INFO m_SystemInformation <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">GetNativeSystemInfo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_SystemInformation<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Native x86, or WOW64 process.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_SystemInformation<span class="token punctuation">.</span>wProcessorArchitecture <span class="token operator">==</span> PROCESSOR_ARCHITECTURE_INTEL <span class="token operator">||</span> this<span class="token operator">-></span><span class="token function">IsWow64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> eProcessArchitecture<span class="token punctuation">:</span><span class="token punctuation">:</span>ARCHITECTURE_x86<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Everything else should be native x64.</span>
        <span class="token keyword">return</span> eProcessArchitecture<span class="token punctuation">:</span><span class="token punctuation">:</span>ARCHITECTURE_x64<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get architecture of target process. </span>
    Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>eProcessArchitecture Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetProcessArchitecture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_eProcessArchitecture<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get PE header data of target process.</span>
    PEHeaderData_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_PEHeaderData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Did we suspend the target process ourselves?</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsManuallySuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_bIsProcessManuallySuspended<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Is the target process suspended?</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Traverse all threads, and ensure each is in a suspended state.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> CurrentThread <span class="token punctuation">:</span> this<span class="token operator">-></span><span class="token function">EnumerateThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>CurrentThread<span class="token punctuation">.</span>m_bIsThreadSuspended<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Is the target process running under a debugger?</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsBeingDebugged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        BOOL m_bHasRemoteDebugger <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
        <span class="token function">CheckRemoteDebuggerPresent</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_bHasRemoteDebugger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m_bHasRemoteDebugger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// The PEB of the target process.</span>
    PEB Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetPEB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        NtQueryInformationProcess_fn NtQueryInformationProcess <span class="token operator">=</span>
            CH_R_CAST<span class="token operator">&lt;</span>NtQueryInformationProcess_fn<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtQueryInformationProcess"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        PROCESS_BASIC_INFORMATION m_ProcessBasicInformation<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Get address where PEB resides in this target process.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">NtQueryInformationProcess</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> PROCESSINFOCLASS<span class="token punctuation">:</span><span class="token punctuation">:</span>ProcessBasicInformation<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span>m_ProcessBasicInformation<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PROCESS_BASIC_INFORMATION<span class="token punctuation">)</span><span class="token punctuation">,</span> nullptr<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x00000000</span><span class="token comment" spellcheck="true">/*STATUS_SUCCESS*/</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"NtQueryInformationProcess failure!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Read PEB from found base address.</span>
        <span class="token keyword">const</span> PEB m_PEB <span class="token operator">=</span> this<span class="token operator">-></span>Read<span class="token operator">&lt;</span>PEB<span class="token operator">></span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_ProcessBasicInformation<span class="token punctuation">.</span>PebBaseAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m_PEB<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Custom struct to pass through as lpReserved to communicate extra data to module.</span>
    <span class="token keyword">struct</span> TransmittedData_t <span class="token punctuation">{</span>
        <span class="token keyword">char</span> szKey<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Data to pass through our shellcode.</span>
    <span class="token keyword">struct</span> LoaderData_t <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_ModuleBase <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_ImageBase <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_EntryPoint <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_LoadLibrary <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_GetProcAddress <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_Memset <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t  m_RelocDirVA <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_RelocDirSize <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_ImportDirVA <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_PEHeaderSize <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_eInjectionFlags <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">,</span> m_Reason <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span>
        TransmittedData_t m_CustomTransmitted <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> LoaderData<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Code to fix up needed data, then execute DllMain in target process.</span>
    <span class="token keyword">void</span> __stdcall <span class="token function">Shellcode</span><span class="token punctuation">(</span>LoaderData_t<span class="token operator">*</span> m_LoaderData<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_TargetBase <span class="token operator">=</span> m_LoaderData<span class="token operator">-></span>m_ModuleBase<span class="token punctuation">;</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_ImageBase <span class="token operator">=</span> m_LoaderData<span class="token operator">-></span>m_ImageBase<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Calculate delta to relocate.</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_Delta <span class="token operator">=</span> m_TargetBase <span class="token operator">-</span> m_ImageBase<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_Delta <span class="token operator">&amp;&amp;</span> m_LoaderData<span class="token operator">-></span>m_RelocDirVA<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Relocate image.</span>
        <span class="token punctuation">{</span>
            PIMAGE_BASE_RELOCATION m_pRelocation <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_BASE_RELOCATION<span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_LoaderData<span class="token operator">-></span>m_RelocDirVA<span class="token punctuation">)</span><span class="token punctuation">;</span>
            PIMAGE_BASE_RELOCATION m_pRelocationEnd <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_BASE_RELOCATION<span class="token operator">></span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pRelocation<span class="token punctuation">)</span> <span class="token operator">+</span> m_LoaderData<span class="token operator">-></span>m_RelocDirSize <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_BASE_RELOCATION<span class="token punctuation">)</span><span class="token comment" spellcheck="true">/*?*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> m_pRelocation <span class="token operator">&lt;</span> m_pRelocationEnd<span class="token punctuation">;</span>
                m_pRelocation <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_BASE_RELOCATION<span class="token operator">></span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pRelocation<span class="token punctuation">)</span> <span class="token operator">+</span> m_pRelocation<span class="token operator">-></span>SizeOfBlock<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token operator">*</span> m_pRelocationType <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_pRelocation <span class="token operator">+</span> <span class="token number">0x1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nRelocationAmount <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">(</span>m_pRelocation<span class="token operator">-></span>SizeOfBlock <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_BASE_RELOCATION<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_nRelocationAmount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>m_pRelocationType<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>m_pRelocationType <span class="token operator">>></span> <span class="token number">0xC</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN64)</span>
                    <span class="token keyword">case</span> IMAGE_REL_BASED_DIR64<span class="token punctuation">:</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
                    <span class="token keyword">case</span> IMAGE_REL_BASED_HIGHLOW<span class="token punctuation">:</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
                        <span class="token operator">*</span>CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_pRelocation<span class="token operator">-></span>VirtualAddress <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>m_pRelocationType<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token operator">=</span> m_Delta<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">typedef</span> <span class="token keyword">int</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> DllMain_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DllMain_fn DllMain <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>DllMain_fn<span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_LoaderData<span class="token operator">-></span>m_EntryPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_LoaderData<span class="token operator">-></span>m_ImportDirVA<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Call EP of our module.</span>
            <span class="token function">DllMain</span><span class="token punctuation">(</span>m_TargetBase<span class="token punctuation">,</span> m_LoaderData<span class="token operator">-></span>m_Reason<span class="token punctuation">,</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_LoaderData<span class="token operator">-></span>m_CustomTransmitted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">typedef</span> <span class="token function">HMODULE</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> LoadLibraryA_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        LoadLibraryA_fn _LoadLibraryA <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>LoadLibraryA_fn<span class="token operator">></span><span class="token punctuation">(</span>m_LoaderData<span class="token operator">-></span>m_LoadLibrary<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">typedef</span> <span class="token function">FARPROC</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> GetProcAddress_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>HMODULE<span class="token punctuation">,</span> LPCSTR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        GetProcAddress_fn _GetProcAddress <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>GetProcAddress_fn<span class="token operator">></span><span class="token punctuation">(</span>m_LoaderData<span class="token operator">-></span>m_GetProcAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Fix up imports.</span>
        PIMAGE_IMPORT_DESCRIPTOR m_pImports <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_IMPORT_DESCRIPTOR<span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_LoaderData<span class="token operator">-></span>m_ImportDirVA<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> m_pImports<span class="token operator">-></span>Name<span class="token punctuation">;</span> <span class="token operator">++</span>m_pImports<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">const</span> HMODULE m_hImportModule <span class="token operator">=</span> <span class="token function">_LoadLibraryA</span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_pImports<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            ULONG_PTR<span class="token operator">*</span> m_pNameReference <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>ULONG_PTR<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_pImports<span class="token operator">-></span>OriginalFirstThunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ULONG_PTR<span class="token operator">*</span> m_pThunk <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>ULONG_PTR<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_pImports<span class="token operator">-></span>FirstThunk<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token operator">*</span>m_pNameReference<span class="token punctuation">;</span> <span class="token operator">++</span>m_pNameReference<span class="token punctuation">,</span> <span class="token operator">++</span>m_pThunk<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IMAGE_SNAP_BY_ORDINAL</span><span class="token punctuation">(</span><span class="token operator">*</span>m_pNameReference<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token operator">*</span>CH_R_CAST<span class="token operator">&lt;</span>FARPROC<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_pThunk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_GetProcAddress</span><span class="token punctuation">(</span>m_hImportModule<span class="token punctuation">,</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">*</span>m_pNameReference <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    PIMAGE_IMPORT_BY_NAME m_pThunkData <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_IMPORT_BY_NAME<span class="token operator">></span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> <span class="token operator">*</span>m_pNameReference<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token operator">*</span>CH_R_CAST<span class="token operator">&lt;</span>FARPROC<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_pThunk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_GetProcAddress</span><span class="token punctuation">(</span>m_hImportModule<span class="token punctuation">,</span> m_pThunkData<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Call EP of our module.</span>
        <span class="token function">DllMain</span><span class="token punctuation">(</span>m_TargetBase<span class="token punctuation">,</span> m_LoaderData<span class="token operator">-></span>m_Reason<span class="token punctuation">,</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_LoaderData<span class="token operator">-></span>m_CustomTransmitted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">typedef</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">(</span>__stdcall<span class="token operator">*</span> memset_fn<span class="token punctuation">)</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        memset_fn _memset <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>memset_fn<span class="token operator">></span><span class="token punctuation">(</span>m_LoaderData<span class="token operator">-></span>m_Memset<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_LoaderData<span class="token operator">-></span>m_eInjectionFlags <span class="token operator">&amp;</span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_EXTRA_WIPEPEHEADERS<span class="token punctuation">)</span>
            <span class="token function">_memset</span><span class="token punctuation">(</span>m_TargetBase<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> m_LoaderData<span class="token operator">-></span>m_PEHeaderSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_LoaderData<span class="token operator">-></span>m_eInjectionFlags <span class="token operator">&amp;</span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_EXTRA_WIPEENTRYPOINT<span class="token punctuation">)</span>
            <span class="token function">_memset</span><span class="token punctuation">(</span>m_TargetBase <span class="token operator">+</span> m_LoaderData<span class="token operator">-></span>m_EntryPoint<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0x20u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Internal manual map function.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ManualMapInject_Internal</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Grab DOS header.</span>
        <span class="token keyword">const</span> PIMAGE_DOS_HEADER m_pDosHeaders <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_DOS_HEADER<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_pDosHeaders<span class="token operator">-></span>e_magic <span class="token operator">!=</span> IMAGE_DOS_SIGNATURE<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't find IMAGE_DOS_SIGNATURE for m_ImageBuffer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Grab NT header.</span>
        <span class="token keyword">const</span> PIMAGE_NT_HEADERS m_pNTHeaders <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> m_pDosHeaders<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>Signature <span class="token operator">!=</span> IMAGE_NT_SIGNATURE<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't find IMAGE_NT_SIGNATURE for m_ImageBuffer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Address our module will be in context of target process.</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_TargetBaseAddress <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">Allocate</span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>SizeOfImage<span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Copy over PE Header to target process.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span><span class="token function">Write</span><span class="token punctuation">(</span>m_TargetBaseAddress<span class="token punctuation">,</span> m_ImageBuffer<span class="token punctuation">,</span> m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>SizeOfImage<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't copy over PE header data to target process."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Copy over needed sections to target process.</span>
        PIMAGE_SECTION_HEADER m_pSectionHeaders <span class="token operator">=</span> <span class="token function">IMAGE_FIRST_SECTION</span><span class="token punctuation">(</span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_pNTHeaders<span class="token operator">-></span>FileHeader<span class="token punctuation">.</span>NumberOfSections<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>m_pSectionHeaders<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_Address <span class="token operator">=</span> m_TargetBaseAddress <span class="token operator">+</span> m_pSectionHeaders<span class="token operator">-></span>VirtualAddress<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span><span class="token function">Write</span><span class="token punctuation">(</span>m_Address<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_ImageBuffer<span class="token punctuation">[</span>m_pSectionHeaders<span class="token operator">-></span>PointerToRawData<span class="token punctuation">]</span><span class="token punctuation">,</span> m_pSectionHeaders<span class="token operator">-></span>SizeOfRawData<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't copy over %s section's data to target process."</span><span class="token punctuation">,</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_pSectionHeaders<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Can use this to communicate some data to the target process.</span>
        <span class="token comment" spellcheck="true">// lpReserved parameter in DllMain is unused, so popping our custom struct here is all good.</span>
        TransmittedData_t m_CustomTransmittedData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        strcpy_s<span class="token operator">&lt;</span><span class="token number">256</span><span class="token operator">></span><span class="token punctuation">(</span>m_CustomTransmittedData<span class="token punctuation">.</span>szKey<span class="token punctuation">,</span> <span class="token string">"Hello from the other side!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Populate loader data structure.</span>
        LoaderData <span class="token operator">=</span> <span class="token punctuation">{</span>
            m_TargetBaseAddress<span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>ImageBase<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>AddressOfEntryPoint<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>LoadLibraryA<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>GetProcAddress<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>memset<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">]</span><span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>SizeOfHeaders<span class="token punctuation">)</span><span class="token punctuation">,</span>
            CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_eInjectionFlags<span class="token punctuation">)</span><span class="token punctuation">,</span>
            DLL_PROCESS_ATTACH<span class="token punctuation">,</span>
            <span class="token constant">NULL</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_eInjectionFlags <span class="token operator">&amp;</span> eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_EXTRA_CUSTOMARGUMENTS<span class="token punctuation">)</span>
            LoaderData<span class="token punctuation">.</span>m_CustomTransmitted <span class="token operator">=</span> m_CustomTransmittedData<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Fix up data if we've built with mismatched architecture.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>Magic <span class="token operator">==</span> IMAGE_NT_OPTIONAL_HDR32_MAGIC<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN64) </span><span class="token comment" spellcheck="true">// Didn't already have NT_HEADERS32 data.</span>
            <span class="token keyword">const</span> PIMAGE_NT_HEADERS32 m_NT32Temporary <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS32<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_EntryPoint <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>AddressOfEntryPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_RelocDirVA <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_RelocDirSize <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">]</span><span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_ImportDirVA <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>Magic <span class="token operator">==</span> IMAGE_NT_OPTIONAL_HDR64_MAGIC<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN32) </span><span class="token comment" spellcheck="true">// Didn't already have NT_HEADERS64 data.</span>
            <span class="token keyword">const</span> PIMAGE_NT_HEADERS64 m_NT64Temporary <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS64<span class="token operator">></span><span class="token punctuation">(</span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_EntryPoint <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>AddressOfEntryPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_RelocDirVA <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_RelocDirSize <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">]</span><span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LoaderData<span class="token punctuation">.</span>m_ImportDirVA <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Address our loader data will be in context of target process.</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_LoaderDataAddress <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">Allocate</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>LoaderData_t<span class="token punctuation">)</span><span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Copy over loader data to target process.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span><span class="token function">Write</span><span class="token punctuation">(</span>m_LoaderDataAddress<span class="token punctuation">,</span> <span class="token operator">&amp;</span>LoaderData<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>LoaderData_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't copy over loader data to target process."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_eInjectionFlags <span class="token operator">&amp;</span> eManualMapInjectionFlags<span class="token punctuation">:</span><span class="token punctuation">:</span>INJECTION_MODE_THREADHIJACK<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Hijack an existing thread in target process to execute our shellcode.</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            <span class="token comment" spellcheck="true">// Simply CreateRemoteThread in target process to execute our shellcode.</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Address our shellcode will be in context of target process.</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_ShellcodeAddress <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">Allocate</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Copy over shellcode to target process.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span><span class="token function">Write</span><span class="token punctuation">(</span>m_ShellcodeAddress<span class="token punctuation">,</span> Shellcode<span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't copy over loader shellcode to target process."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_nThreadResult <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">_CreateRemoteThread</span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span>LPVOID<span class="token operator">></span><span class="token punctuation">(</span>m_ShellcodeAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> CH_R_CAST<span class="token operator">&lt;</span>LPVOID<span class="token operator">></span><span class="token punctuation">(</span>m_LoaderDataAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nThreadResult <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Failed to create remote thread in target process with code %i."</span><span class="token punctuation">,</span> m_nThreadResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Manual map injection from module on disk.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ManualMapInject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDLLPath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ByteArray_t m_FileImageBuffer <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Fill local image buffer from file on disk.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>ifstream <span class="token function">m_fFile</span><span class="token punctuation">(</span>m_szDLLPath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>ios<span class="token punctuation">:</span><span class="token punctuation">:</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token operator">&amp;</span>m_FileImageBuffer<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>istreambuf_iterator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span>m_fFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>istreambuf_iterator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_fFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_FileImageBuffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't parse desired m_ImageBuffer to manual map."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token function">ManualMapInject_Internal</span><span class="token punctuation">(</span>m_FileImageBuffer<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_eInjectionFlags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Manual map injection from module in memory.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ManualMapInject</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span>  std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ManualMapInject_Internal</span><span class="token punctuation">(</span>m_ImageBuffer<span class="token punctuation">,</span> m_eInjectionFlags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Manual map injection from ImageFile_t.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ManualMapInject</span><span class="token punctuation">(</span>ImageFile_t<span class="token operator">&amp;</span> m_ImageFile<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_eInjectionFlags<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_ImageFile<span class="token punctuation">.</span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't parse desired ImageFile_t to manual map."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token function">ManualMapInject_Internal</span><span class="token punctuation">(</span>m_ImageFile<span class="token punctuation">.</span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_eInjectionFlags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// LoadLibrary injection from module on disk.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">LoadLibraryInject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDLLPath<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Allocate memory in target process.</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_AllocatedMemory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">Allocate</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>m_szDLLPath<span class="token punctuation">)</span><span class="token punctuation">,</span> PAGE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_AllocatedMemory<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't allocate memory to target process. Error code was #%i"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Write string name for our module in previously allocated space.</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nWrittenBytes <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">Write</span><span class="token punctuation">(</span>m_AllocatedMemory<span class="token punctuation">,</span> CH_C_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_szDLLPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_nWrittenBytes<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't write module name to target process. Error code was #%i"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Load DLL by invoking LoadLibrary(m_szDLLPath) in a target process</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_nThreadResult <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">_CreateRemoteThread</span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span>LPVOID<span class="token operator">></span><span class="token punctuation">(</span>LoadLibraryA<span class="token punctuation">)</span><span class="token punctuation">,</span> CH_R_CAST<span class="token operator">&lt;</span>LPVOID<span class="token operator">></span><span class="token punctuation">(</span>m_AllocatedMemory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nThreadResult <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Failed to create remote thread in target process with code %i."</span><span class="token punctuation">,</span> m_nThreadResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Traverse and cache data about all threads in a target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>ThreadInformation_t<span class="token operator">></span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">EnumerateThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>ThreadInformation_t<span class="token operator">></span> m_EnumeratedThreads <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        HANDLE m_hSnapShot <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span>TH32CS_SNAPTHREAD<span class="token punctuation">,</span> this<span class="token operator">-></span>m_nTargetProcessID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span>NtQueryInformationThread_fn NtQueryInformationThread <span class="token operator">=</span>
            CH_R_CAST<span class="token operator">&lt;</span>Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span>NtQueryInformationThread_fn<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtQueryInformationThread"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        THREADENTRY32 mEntry <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        mEntry<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>mEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Thread32First</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mEntry<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">Thread32Next</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mEntry<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Ensure our target process owns this thread.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mEntry<span class="token punctuation">.</span>th32OwnerProcessID <span class="token operator">!=</span> this<span class="token operator">-></span>m_nTargetProcessID<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Open handle to this specific thread.</span>
            HANDLE m_hThreadHandle <span class="token operator">=</span> <span class="token function">OpenThread</span><span class="token punctuation">(</span>THREAD_ALL_ACCESS<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> mEntry<span class="token punctuation">.</span>th32ThreadID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_hThreadHandle <span class="token operator">||</span> m_hThreadHandle <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token function">ADD_SCOPE_HANDLER</span><span class="token punctuation">(</span>CloseHandle<span class="token punctuation">,</span> m_hThreadHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

            DWORD m_dThreadStartAddress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">NtQueryInformationThread</span><span class="token punctuation">(</span>m_hThreadHandle<span class="token punctuation">,</span>
                Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span>THREADINFOCLASS<span class="token punctuation">:</span><span class="token punctuation">:</span>ThreadQuerySetWin32StartAddress<span class="token punctuation">,</span>
                <span class="token operator">&amp;</span>m_dThreadStartAddress<span class="token punctuation">,</span>
                this<span class="token operator">-></span>m_eProcessArchitecture <span class="token operator">==</span> eProcessArchitecture<span class="token punctuation">:</span><span class="token punctuation">:</span>ARCHITECTURE_x64 <span class="token operator">?</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">,</span>
                nullptr<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x00000000</span><span class="token comment" spellcheck="true">/*STATUS_SUCCESS*/</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            
            <span class="token keyword">const</span> bool m_bIsThreadSuspended <span class="token operator">=</span> <span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>m_hThreadHandle<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> WAIT_ABANDONED<span class="token punctuation">;</span>

            m_EnumeratedThreads<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>
                <span class="token punctuation">{</span> mEntry<span class="token punctuation">.</span>th32ThreadID<span class="token punctuation">,</span>
                m_dThreadStartAddress<span class="token punctuation">,</span>
                m_bIsThreadSuspended <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> m_EnumeratedThreads<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Traverse and cache data about all loaded modules in a target process.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>ModuleInformation_t<span class="token operator">></span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">EnumerateModules</span><span class="token punctuation">(</span>bool m_bUseCachedData<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// To take up less processing power, or if you know nothing will be loaded into the target process unexpectedly.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_bUseCachedData <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_bHasCachedProcessesModules<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span>m_EnumeratedModulesCached<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> this<span class="token operator">-></span>m_EnumeratedModulesCached<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span>m_EnumeratedModulesCached<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Wipe any previously cached data.</span>
            this<span class="token operator">-></span>m_EnumeratedModulesCached<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        HANDLE m_hSnapShot <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span>TH32CS_SNAPMODULE<span class="token punctuation">,</span> this<span class="token operator">-></span>m_nTargetProcessID<span class="token punctuation">)</span><span class="token punctuation">;</span>

        MODULEENTRY32 mEntry <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        mEntry<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>mEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">Module32Next</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mEntry<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            wchar_t m_wszModPath<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetModuleFileNameEx</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> mEntry<span class="token punctuation">.</span>hModule<span class="token punctuation">,</span> m_wszModPath<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_wszModPath<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>wchar_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            m_wszModPath<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Convert wstring->string.</span>
            _bstr_t <span class="token function">m_bszPreModulePath</span><span class="token punctuation">(</span>m_wszModPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _bstr_t <span class="token function">m_bszPreModuleName</span><span class="token punctuation">(</span>mEntry<span class="token punctuation">.</span>szModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">m_szModulePath</span><span class="token punctuation">(</span>m_bszPreModulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>string <span class="token function">m_szModuleName</span><span class="token punctuation">(</span>m_bszPreModuleName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            this<span class="token operator">-></span>m_EnumeratedModulesCached<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                m_szModuleName<span class="token punctuation">,</span> m_szModulePath<span class="token punctuation">,</span>
                CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>mEntry<span class="token punctuation">.</span>modBaseSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
                CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span>mEntry<span class="token punctuation">.</span>modBaseAddr<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>m_hSnapShot<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> this<span class="token operator">-></span>m_EnumeratedModulesCached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Sets debug privileges of a target process.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">SetDebugPrivilege</span><span class="token punctuation">(</span>bool m_bShouldEnable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        HANDLE m_hToken<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">OpenProcessToken</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> TOKEN_ALL_ACCESS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_hToken<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>

        <span class="token function">ADD_SCOPE_HANDLER</span><span class="token punctuation">(</span>CloseHandle<span class="token punctuation">,</span> m_hToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

        LUID m_LUID<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">LookupPrivilegeValue</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> L<span class="token string">"SeDebugPrivilege"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_LUID<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>

        TOKEN_PRIVILEGES m_TokenPrivileges<span class="token punctuation">;</span>
        m_TokenPrivileges<span class="token punctuation">.</span>PrivilegeCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        m_TokenPrivileges<span class="token punctuation">.</span>Privileges<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Luid <span class="token operator">=</span> m_LUID<span class="token punctuation">;</span>
        m_TokenPrivileges<span class="token punctuation">.</span>Privileges<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Attributes <span class="token operator">=</span> m_bShouldEnable <span class="token operator">?</span> SE_PRIVILEGE_ENABLED <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> bool result <span class="token operator">=</span>
            <span class="token function">AdjustTokenPrivileges</span><span class="token punctuation">(</span>m_hToken<span class="token punctuation">,</span> false<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_TokenPrivileges<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_TokenPrivileges<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token operator">&amp;&amp;</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> ERROR_NOT_ALL_ASSIGNED<span class="token punctuation">;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Suspend every thread in a target process.</span>
    <span class="token keyword">void</span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        NtSuspendProcess_fn NtSuspendProcess <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>NtSuspendProcess_fn<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtSuspendProcess"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_bIsProcessManuallySuspended <span class="token operator">=</span> <span class="token function">NtSuspendProcess</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00000000</span><span class="token comment" spellcheck="true">/*STATUS_SUCCESS*/</span><span class="token punctuation">;</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>false<span class="token punctuation">,</span> this<span class="token operator">-></span>m_bIsProcessManuallySuspended<span class="token punctuation">,</span> <span class="token string">"Failed to suspend process!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Resume every previously suspended thread in a target process.</span>
    <span class="token keyword">void</span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO: Is there any use case of resuming a suspended process (that WE didn't suspend??).</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_bIsProcessManuallySuspended<span class="token punctuation">,</span> <span class="token string">"Attempted to resume process that was never suspended!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        NtResumeProcess_fn NtResumeProcess <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>NtResumeProcess_fn<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtResumeProcess"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bIsProcessManuallySuspended <span class="token operator">=</span> <span class="token function">NtResumeProcess</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x00000000</span><span class="token comment" spellcheck="true">/*STATUS_SUCCESS*/</span><span class="token punctuation">;</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>false<span class="token punctuation">,</span> this<span class="token operator">-></span>m_bIsProcessManuallySuspended <span class="token operator">==</span> false<span class="token punctuation">,</span> <span class="token string">"Failed to resume suspended process!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get desired export address by name.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetRemoteProcAddress</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szExportName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Module_t <span class="token function">m_Module</span><span class="token punctuation">(</span><span class="token operator">*</span>this<span class="token punctuation">,</span>
            m_szModuleName<span class="token punctuation">,</span>
            PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_EXPORT_DIRECTORY <span class="token comment" spellcheck="true">// Only parse exports.</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_Module<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>m_Module<span class="token punctuation">.</span><span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0u</span><span class="token punctuation">;</span>

        <span class="token keyword">auto</span> ExportData <span class="token operator">=</span> m_Module<span class="token punctuation">.</span><span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetExportData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ExportData<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> ExportData<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>m_szExportName<span class="token punctuation">)</span> <span class="token operator">==</span> ExportData<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Ensure we even have this export in our map.        </span>
            <span class="token keyword">return</span> <span class="token number">0u</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> ExportData<span class="token punctuation">[</span>m_szExportName<span class="token punctuation">]</span><span class="token punctuation">.</span>m_nAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// VirtualAllocEx implementation.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Allocate</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_AllocationSize<span class="token punctuation">,</span> DWORD m_dProtectionType<span class="token punctuation">,</span> bool m_bShouldTrack<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_AllocatedMemory <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">VirtualAllocEx</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> nullptr<span class="token punctuation">,</span> m_AllocationSize<span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> m_dProtectionType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_AllocatedMemory <span class="token operator">&amp;&amp;</span> m_bShouldTrack<span class="token punctuation">)</span>
            this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> m_AllocatedMemory<span class="token punctuation">,</span> m_AllocationSize <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> m_AllocatedMemory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// VirtualFreeEx implementation.</span>
    bool Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Free</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_FreeAddress<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">const</span> bool m_bDidFree <span class="token operator">=</span> <span class="token function">VirtualFreeEx</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span>m_FreeAddress<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> MEM_RELEASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_bDidFree <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>m_FreeAddress<span class="token punctuation">)</span> <span class="token operator">!=</span> this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_AllocatedMemoryTracker<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>m_FreeAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> m_bDidFree<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// VirtualQueryEx implementation.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Query</span><span class="token punctuation">(</span>LPCVOID m_QueryAddress<span class="token punctuation">,</span> MEMORY_BASIC_INFORMATION<span class="token operator">*</span> m_MemoryInformation<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">VirtualQueryEx</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span> m_QueryAddress<span class="token punctuation">,</span> m_MemoryInformation<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>MEMORY_BASIC_INFORMATION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// CreateRemoteThread implementation.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">_CreateRemoteThread</span><span class="token punctuation">(</span>LPVOID m_lpStartAddress<span class="token punctuation">,</span> LPVOID m_lpParameter<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        HANDLE m_hRemoteThread <span class="token operator">=</span> <span class="token function">CreateRemoteThread</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetProcessHandle<span class="token punctuation">,</span>
            <span class="token constant">NULL</span><span class="token punctuation">,</span>
            <span class="token constant">NULL</span><span class="token punctuation">,</span>
            CH_R_CAST<span class="token operator">&lt;</span>LPTHREAD_START_ROUTINE<span class="token operator">></span><span class="token punctuation">(</span>m_lpStartAddress<span class="token punctuation">)</span><span class="token punctuation">,</span>
            m_lpParameter<span class="token punctuation">,</span>
            <span class="token constant">NULL</span><span class="token punctuation">,</span>
            <span class="token constant">NULL</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_hRemoteThread <span class="token operator">||</span> m_hRemoteThread <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token function">ADD_SCOPE_HANDLER</span><span class="token punctuation">(</span>CloseHandle<span class="token punctuation">,</span> m_hRemoteThread<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>m_hRemoteThread<span class="token punctuation">,</span> INFINITE<span class="token punctuation">)</span> <span class="token operator">==</span> WAIT_FAILED<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// GetModule implementation.</span>
    Module_t<span class="token operator">&amp;</span> Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetModule</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Invalid process called GetModule : %s"</span><span class="token punctuation">,</span> m_szProcessName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_AllocatedModules<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>m_szModuleName<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0u</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> m_AllocatedModules<span class="token punctuation">[</span>m_szModuleName<span class="token punctuation">]</span><span class="token punctuation">;</span>

        Module_t <span class="token function">m_Module</span><span class="token punctuation">(</span><span class="token operator">*</span>this<span class="token punctuation">,</span> m_szModuleName<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_AllocatedModules<span class="token punctuation">[</span>m_szModuleName<span class="token punctuation">]</span> <span class="token operator">=</span> m_Module<span class="token punctuation">;</span>

        <span class="token keyword">return</span> m_AllocatedModules<span class="token punctuation">[</span>m_szModuleName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// PEHeaderData_t definitions and functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Parsing data out of this image's buffer.</span>
    PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_ImageSize<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_NONE<span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> m_ImageBuffer <span class="token operator">&amp;&amp;</span> m_ImageSize<span class="token punctuation">,</span> <span class="token string">"Failed to read PE image."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_pDOSHeaders <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_DOS_HEADER<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_pNTHeaders <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span>m_pDOSHeaders<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bIsValidInternal <span class="token operator">=</span>
            this<span class="token operator">-></span>m_pDOSHeaders<span class="token operator">-></span>e_magic <span class="token operator">==</span> IMAGE_DOS_SIGNATURE <span class="token operator">&amp;&amp;</span>
            this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>Signature <span class="token operator">==</span> IMAGE_NT_SIGNATURE<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ensure image PE headers was valid.</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Couldn't find MZ&amp;NT header."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        PIMAGE_SECTION_HEADER m_pSectionHeaders <span class="token operator">=</span> <span class="token function">IMAGE_FIRST_SECTION</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_pNTHeaders<span class="token operator">-></span>FileHeader<span class="token punctuation">.</span>NumberOfSections<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>m_pSectionHeaders<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            this<span class="token operator">-></span>m_SectionData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>
                <span class="token punctuation">{</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_pSectionHeaders<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token operator">-></span>VirtualAddress<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token operator">-></span>Misc<span class="token punctuation">.</span>VirtualSize<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token operator">-></span>Characteristics<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token operator">-></span>PointerToRawData<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token operator">-></span>PointerToRawData <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR<span class="token comment" spellcheck="true">/*Maximum*/</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Gather all needed directories, then ensure we're using the correct type for the image.</span>
        IMAGE_DATA_DIRECTORY m_ExportDataDirectory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IMAGE_DATA_DIRECTORY m_ImportDataDirectory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IMAGE_DATA_DIRECTORY m_DebugDataDirectory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>IMAGE_DIRECTORY_ENTRY_DEBUG<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>Magic <span class="token operator">==</span> IMAGE_NT_OPTIONAL_HDR32_MAGIC<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN64) </span><span class="token comment" spellcheck="true">// Didn't already have NT_HEADERS32 data.</span>
            <span class="token keyword">const</span> PIMAGE_NT_HEADERS32 m_NT32Temporary <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS32<span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_ExportDataDirectory <span class="token operator">=</span> m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_ImportDataDirectory <span class="token operator">=</span> m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_DebugDataDirectory <span class="token operator">=</span> m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_DEBUG<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">// Reset directory data to be filled with one of correct architecture.</span>
                this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR<span class="token comment" spellcheck="true">/*Maximum*/</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
                this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>Magic <span class="token operator">==</span> IMAGE_NT_OPTIONAL_HDR64_MAGIC<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN32) </span><span class="token comment" spellcheck="true">// Didn't already have NT_HEADERS64 data.</span>
            <span class="token keyword">const</span> PIMAGE_NT_HEADERS64 m_NT64Temporary <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS64<span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_ExportDataDirectory <span class="token operator">=</span> m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_ImportDataDirectory <span class="token operator">=</span> m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_DebugDataDirectory <span class="token operator">=</span> m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_DEBUG<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment" spellcheck="true">// Reset directory data to be filled with one of correct architecture.</span>
                this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR<span class="token comment" spellcheck="true">/*Maximum*/</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
                this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool bDebugEnabled <span class="token operator">=</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_DEBUG_DIRECTORY <span class="token operator">||</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bDebugEnabled <span class="token operator">||</span>
            <span class="token operator">!</span>m_DebugDataDirectory<span class="token punctuation">.</span>VirtualAddress <span class="token operator">||</span>
            <span class="token operator">!</span>m_DebugDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bDebugEnabled<span class="token punctuation">)</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Debug table didn't exist for current region. 0x%x | 0X%x"</span><span class="token punctuation">,</span> m_DebugDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_DebugDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// Debug table parsing.</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">const</span> PIMAGE_DEBUG_DIRECTORY m_DebugDirectoryData <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_DEBUG_DIRECTORY<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_DebugDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_DebugDirectoryData<span class="token operator">-></span>Type <span class="token operator">==</span> IMAGE_DEBUG_TYPE_CODEVIEW<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">const</span> CV_INFO_PDB70<span class="token operator">*</span> m_PDBInfo <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>CV_INFO_PDB70<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_DebugDirectoryData<span class="token operator">-></span>AddressOfRawData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                wchar_t m_wszGUIDStr<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">StringFromGUID2</span><span class="token punctuation">(</span>m_PDBInfo<span class="token operator">-></span>Signature<span class="token punctuation">,</span> m_wszGUIDStr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_wszGUIDStr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// Couldn't read GUID, whatever lol.</span>
                    this<span class="token operator">-></span>m_DebugData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>m_PDBInfo<span class="token operator">-></span>PdbFileName<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> m_PDBInfo<span class="token operator">-></span>Age<span class="token punctuation">,</span> m_PDBInfo<span class="token operator">-></span>CvSignature <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    m_wszGUIDStr<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">// wchar_t->string</span>
                    _bstr_t <span class="token function">m_szPreGUIDStr</span><span class="token punctuation">(</span>m_wszGUIDStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    this<span class="token operator">-></span>m_DebugData <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>m_PDBInfo<span class="token operator">-></span>PdbFileName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">string</span><span class="token punctuation">(</span>m_szPreGUIDStr<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        m_PDBInfo<span class="token operator">-></span>Age<span class="token punctuation">,</span> m_PDBInfo<span class="token operator">-></span>CvSignature
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool bExportsEnabled <span class="token operator">=</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_EXPORT_DIRECTORY <span class="token operator">||</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bExportsEnabled <span class="token operator">||</span>
            <span class="token operator">!</span>m_ExportDataDirectory<span class="token punctuation">.</span>VirtualAddress <span class="token operator">||</span>
            <span class="token operator">!</span>m_ExportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bExportsEnabled<span class="token punctuation">)</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Export table didn't exist for current region. 0x%x | 0X%x"</span><span class="token punctuation">,</span> m_ExportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_ExportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// Export table parsing.</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">const</span> PIMAGE_EXPORT_DIRECTORY m_pExportDirectory <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_EXPORT_DIRECTORY<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_ExportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token operator">*</span> m_pOrdinalAddress <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_pExportDirectory<span class="token operator">-></span>AddressOfNameOrdinals<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">*</span> m_pNamesAddress <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_pExportDirectory<span class="token operator">-></span>AddressOfNames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">*</span> m_pFunctionAddress <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_pExportDirectory<span class="token operator">-></span>AddressOfFunctions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Traverse export table and cache desired data.</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_pExportDirectory<span class="token operator">-></span>NumberOfNames<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t m_CurrentOrdinal <span class="token operator">=</span> m_pOrdinalAddress<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_CurrentName <span class="token operator">=</span> m_pNamesAddress<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_CurrentName <span class="token operator">==</span> <span class="token number">0u</span> <span class="token operator">||</span> m_CurrentOrdinal <span class="token operator">></span> m_pExportDirectory<span class="token operator">-></span>NumberOfNames<span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// Happend a few times, dunno.</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>

                <span class="token keyword">char</span><span class="token operator">*</span> m_szExportName <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_CurrentName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                this<span class="token operator">-></span>m_ExportData<span class="token punctuation">[</span>m_szExportName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> m_pFunctionAddress<span class="token punctuation">[</span>m_CurrentOrdinal<span class="token punctuation">]</span><span class="token punctuation">,</span> m_CurrentOrdinal <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool bImportsEnabled <span class="token operator">=</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_IMPORT_DIRECTORY <span class="token operator">||</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bImportsEnabled <span class="token operator">||</span>
            <span class="token operator">!</span>m_ImportDataDirectory<span class="token punctuation">.</span>VirtualAddress <span class="token operator">||</span>
            <span class="token operator">!</span>m_ImportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bImportsEnabled<span class="token punctuation">)</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Import table didn't exist for current region. 0x%X | 0x%X"</span><span class="token punctuation">,</span>
                    m_ImportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_ImportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// Import table parsing.</span>
        <span class="token punctuation">{</span>
            PIMAGE_IMPORT_DESCRIPTOR m_pImportDescriptor <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_IMPORT_DESCRIPTOR<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_ImportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> m_pImportDescriptor<span class="token operator">-></span>Name<span class="token punctuation">;</span> <span class="token operator">++</span>m_pImportDescriptor<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// Read module name.</span>
                <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_pImportDescriptor<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                PIMAGE_THUNK_DATA m_pThunkData <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_THUNK_DATA<span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>m_pImportDescriptor<span class="token operator">-></span>OriginalFirstThunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> m_pThunkData<span class="token operator">-></span>u1<span class="token punctuation">.</span>AddressOfData<span class="token punctuation">;</span> <span class="token operator">++</span>m_pThunkData<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_pThunkData<span class="token operator">-></span>u1<span class="token punctuation">.</span>Ordinal <span class="token operator">&amp;</span> IMAGE_ORDINAL_FLAG32<span class="token punctuation">)</span>
                        <span class="token comment" spellcheck="true">// TODO: Imports by ordinal, dunno how I will make this nice.</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">// Read function name.</span>
                    <span class="token keyword">char</span><span class="token operator">*</span> m_szFunctionName <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImageBuffer <span class="token operator">+</span> this<span class="token operator">-></span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">uint32_t</span><span class="token punctuation">(</span>m_pThunkData<span class="token operator">-></span>u1<span class="token punctuation">.</span>AddressOfData <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">// Cache desired data.</span>
                    this<span class="token operator">-></span>m_ImportData<span class="token punctuation">[</span>m_szFunctionName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> m_szModuleName <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
     
    <span class="token comment" spellcheck="true">// Parsing data out of this image's process.</span>
    PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_CustomBaseAddress<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_NONE<span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_BaseAddress <span class="token operator">=</span> m_CustomBaseAddress <span class="token operator">!=</span> <span class="token number">0u</span> <span class="token operator">?</span> m_CustomBaseAddress <span class="token punctuation">:</span> m_Process<span class="token punctuation">.</span><span class="token function">GetBaseAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> m_BaseAddress<span class="token punctuation">,</span> <span class="token string">"Couldn't find base address of target process."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        IMAGE_DOS_HEADER m_pDOSHeadersTemporary <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>IMAGE_DOS_HEADER<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_pDOSHeaders <span class="token operator">=</span> <span class="token operator">&amp;</span>m_pDOSHeadersTemporary<span class="token punctuation">;</span>

        IMAGE_NT_HEADERS m_pNTHeadersTemporary <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>IMAGE_NT_HEADERS<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> this<span class="token operator">-></span>m_pDOSHeaders<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_pNTHeaders <span class="token operator">=</span> <span class="token operator">&amp;</span>m_pNTHeadersTemporary<span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bIsValidInternal <span class="token operator">=</span>
            this<span class="token operator">-></span>m_pDOSHeaders<span class="token operator">-></span>e_magic <span class="token operator">==</span> IMAGE_DOS_SIGNATURE <span class="token operator">&amp;&amp;</span>
            this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>Signature <span class="token operator">==</span> IMAGE_NT_SIGNATURE<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ensure image PE headers was valid.</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Couldn't find MZ&amp;NT header."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_pNTHeaders<span class="token operator">-></span>FileHeader<span class="token punctuation">.</span>NumberOfSections<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nSectionOffset <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_NT_HEADERS<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_SECTION_HEADER<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            IMAGE_SECTION_HEADER m_pSectionHeaders <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>IMAGE_SECTION_HEADER<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> this<span class="token operator">-></span>m_pDOSHeaders<span class="token operator">-></span>e_lfanew <span class="token operator">+</span> m_nSectionOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

            this<span class="token operator">-></span>m_SectionData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>
                <span class="token punctuation">{</span> CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_pSectionHeaders<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token punctuation">.</span>Misc<span class="token punctuation">.</span>VirtualSize<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token punctuation">.</span>Characteristics<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token punctuation">.</span>PointerToRawData<span class="token punctuation">,</span>
                m_pSectionHeaders<span class="token punctuation">.</span>SizeOfRawData <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR<span class="token comment" spellcheck="true">/*Maximum*/</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Gather all needed directories, then ensure we're using the correct type for the image.</span>
        IMAGE_DATA_DIRECTORY m_ExportDataDirectory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IMAGE_DATA_DIRECTORY m_ImportDataDirectory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IMAGE_DATA_DIRECTORY m_DebugDataDirectory <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>IMAGE_DIRECTORY_ENTRY_DEBUG<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>Magic <span class="token operator">==</span> IMAGE_NT_OPTIONAL_HDR32_MAGIC<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN64) </span><span class="token comment" spellcheck="true">// Didn't already have NT_HEADERS32 data.</span>
            <span class="token keyword">const</span> PIMAGE_NT_HEADERS32 m_NT32Temporary <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS32<span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_ExportDataDirectory <span class="token operator">=</span> m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_ImportDataDirectory <span class="token operator">=</span> m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_DebugDataDirectory <span class="token operator">=</span> m_NT32Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_DEBUG<span class="token punctuation">]</span><span class="token punctuation">;</span>
            this<span class="token operator">-></span>m_nMismatchedArchitecture <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>eProcessArchitecture<span class="token punctuation">:</span><span class="token punctuation">:</span>ARCHITECTURE_x64<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// For future notifications of dangerous actions.</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>Magic <span class="token operator">==</span> IMAGE_NT_OPTIONAL_HDR64_MAGIC<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (_WIN32) </span><span class="token comment" spellcheck="true">// Didn't already have NT_HEADERS64 data.</span>
            <span class="token keyword">const</span> PIMAGE_NT_HEADERS64 m_NT64Temporary <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_NT_HEADERS64<span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_pNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_ExportDataDirectory <span class="token operator">=</span> m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_ImportDataDirectory <span class="token operator">=</span> m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">]</span><span class="token punctuation">;</span>
            m_DebugDataDirectory <span class="token operator">=</span> m_NT64Temporary<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_DEBUG<span class="token punctuation">]</span><span class="token punctuation">;</span>
            this<span class="token operator">-></span>m_nMismatchedArchitecture <span class="token operator">=</span> CH_S_CAST<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">></span><span class="token punctuation">(</span>Process_t<span class="token punctuation">:</span><span class="token punctuation">:</span>eProcessArchitecture<span class="token punctuation">:</span><span class="token punctuation">:</span>ARCHITECTURE_x64<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// For future notifications of dangerous actions.</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool bDebugEnabled <span class="token operator">=</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_DEBUG_DIRECTORY <span class="token operator">||</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bDebugEnabled <span class="token operator">||</span>
            <span class="token operator">!</span>m_DebugDataDirectory<span class="token punctuation">.</span>VirtualAddress <span class="token operator">||</span>
            <span class="token operator">!</span>m_DebugDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bDebugEnabled<span class="token punctuation">)</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Debug table didn't exist for current region. 0x%x | 0X%x"</span><span class="token punctuation">,</span> m_DebugDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_DebugDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// Debug table parsing.</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">const</span> IMAGE_DEBUG_DIRECTORY m_DebugDirectoryData <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>IMAGE_DEBUG_DIRECTORY<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_DebugDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_DebugDirectoryData<span class="token punctuation">.</span>Type <span class="token operator">==</span> IMAGE_DEBUG_TYPE_CODEVIEW<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">const</span> CV_INFO_PDB70 m_PDBInfo <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>CV_INFO_PDB70<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_DebugDirectoryData<span class="token punctuation">.</span>AddressOfRawData<span class="token punctuation">)</span><span class="token punctuation">;</span>

                wchar_t m_wszGUIDStr<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">StringFromGUID2</span><span class="token punctuation">(</span>m_PDBInfo<span class="token punctuation">.</span>Signature<span class="token punctuation">,</span> m_wszGUIDStr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_wszGUIDStr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// Couldn't read GUID, whatever lol.</span>
                    this<span class="token operator">-></span>m_DebugData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>m_PDBInfo<span class="token punctuation">.</span>PdbFileName<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> m_PDBInfo<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> m_PDBInfo<span class="token punctuation">.</span>CvSignature <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    m_wszGUIDStr<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">// wchar_t->string</span>
                    _bstr_t <span class="token function">m_szPreGUIDStr</span><span class="token punctuation">(</span>m_wszGUIDStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    this<span class="token operator">-></span>m_DebugData <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>m_PDBInfo<span class="token punctuation">.</span>PdbFileName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">string</span><span class="token punctuation">(</span>m_szPreGUIDStr<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        m_PDBInfo<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> m_PDBInfo<span class="token punctuation">.</span>CvSignature
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool bExportsEnabled <span class="token operator">=</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_EXPORT_DIRECTORY <span class="token operator">||</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bExportsEnabled <span class="token operator">||</span>
            <span class="token operator">!</span>m_ExportDataDirectory<span class="token punctuation">.</span>VirtualAddress <span class="token operator">||</span>
            <span class="token operator">!</span>m_ExportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bExportsEnabled<span class="token punctuation">)</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Export table didn't exist for current region. 0x%x | 0X%x"</span><span class="token punctuation">,</span>
                    m_ExportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_ExportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// Export table parsing.</span>
        <span class="token punctuation">{</span>
            IMAGE_EXPORT_DIRECTORY m_pExportDirectory <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>IMAGE_EXPORT_DIRECTORY<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> <span class="token punctuation">(</span>uintptr_t<span class="token punctuation">)</span>m_ExportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Read whole RVA block.</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span> m_FuncRVABlock <span class="token operator">=</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>make_unique<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span>m_pExportDirectory<span class="token punctuation">.</span>NumberOfFunctions <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nReadRVA <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_pExportDirectory<span class="token punctuation">.</span>AddressOfFunctions<span class="token punctuation">,</span> m_FuncRVABlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_pExportDirectory<span class="token punctuation">.</span>NumberOfFunctions <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Read whole name block.</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span> m_NameRVABlock <span class="token operator">=</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>make_unique<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span>m_pExportDirectory<span class="token punctuation">.</span>NumberOfNames <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nReadName <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_pExportDirectory<span class="token punctuation">.</span>AddressOfNames<span class="token punctuation">,</span> m_NameRVABlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_pExportDirectory<span class="token punctuation">.</span>NumberOfNames <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Read whole ordinal block.</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span> m_OrdinalBlock <span class="token operator">=</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>make_unique<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span>m_pExportDirectory<span class="token punctuation">.</span>NumberOfNames <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nReadOrdinal <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_pExportDirectory<span class="token punctuation">.</span>AddressOfNameOrdinals<span class="token punctuation">,</span> m_OrdinalBlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_pExportDirectory<span class="token punctuation">.</span>NumberOfNames <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Ye.</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">*</span> m_pFuncBlock <span class="token operator">=</span> m_FuncRVABlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token operator">*</span> m_pNameBlock <span class="token operator">=</span> m_NameRVABlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t<span class="token operator">*</span> m_pOrdinalBlock <span class="token operator">=</span> m_OrdinalBlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Traverse export table and cache desired data.</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_pExportDirectory<span class="token punctuation">.</span>NumberOfNames<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nReadRVA <span class="token operator">==</span> <span class="token number">0u</span> <span class="token operator">||</span> m_nReadName <span class="token operator">==</span> <span class="token number">0u</span> <span class="token operator">||</span> m_nReadOrdinal <span class="token operator">==</span> <span class="token number">0u</span><span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// One or more read failed, no point to waste time here.</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint16_t m_CurrentOrdinal <span class="token operator">=</span> m_pOrdinalBlock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_CurrentName <span class="token operator">=</span> m_pNameBlock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_CurrentName <span class="token operator">==</span> <span class="token number">0u</span> <span class="token operator">||</span> m_CurrentOrdinal <span class="token operator">></span> m_pExportDirectory<span class="token punctuation">.</span>NumberOfNames<span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// Happend a few times, dunno.</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">// Read export name.</span>
                <span class="token keyword">char</span> m_szExportName<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_ReadNameBytes <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_CurrentName<span class="token punctuation">,</span> m_szExportName<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_szExportName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_ReadNameBytes <span class="token operator">==</span> <span class="token number">0u</span><span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// Something went wrong while reading exp name, don't cache this.</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>

                m_szExportName<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">// Cache desired data.</span>
                this<span class="token operator">-></span>m_ExportData<span class="token punctuation">[</span>m_szExportName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> m_pFuncBlock<span class="token punctuation">[</span>m_CurrentOrdinal<span class="token punctuation">]</span><span class="token punctuation">,</span> m_CurrentOrdinal <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool bImportsEnabled <span class="token operator">=</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_IMPORT_DIRECTORY <span class="token operator">||</span> m_ParseType <span class="token operator">&amp;</span> PEHEADER_PARSING_TYPE<span class="token punctuation">:</span><span class="token punctuation">:</span>TYPE_ALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bImportsEnabled <span class="token operator">||</span>
            <span class="token operator">!</span>m_ImportDataDirectory<span class="token punctuation">.</span>VirtualAddress <span class="token operator">||</span>
            <span class="token operator">!</span>m_ImportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bImportsEnabled<span class="token punctuation">)</span>
                <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Import table didn't exist for current region. 0x%X | 0x%X"</span><span class="token punctuation">,</span>
                    m_ImportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_ImportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// Import table parsing.</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Read whole descriptor block.</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span> m_ImpDescriptorBlock <span class="token operator">=</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>make_unique<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span>m_ImportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_ImportDataDirectory<span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">,</span> m_ImpDescriptorBlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_ImportDataDirectory<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">const</span> IMAGE_IMPORT_DESCRIPTOR m_pImportDescriptor <span class="token operator">=</span> CH_R_CAST<span class="token operator">&lt;</span>PIMAGE_IMPORT_DESCRIPTOR<span class="token operator">></span><span class="token punctuation">(</span>m_ImpDescriptorBlock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_pImportDescriptor<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">// Read module name.</span>
                <span class="token keyword">char</span> m_szModuleName<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nReadModuleName <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> m_pImportDescriptor<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> m_szModuleName<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_szModuleName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nReadModuleName <span class="token operator">==</span> <span class="token number">0u</span><span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">// Something went wrong while reading imp module, don't cache this.</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>

                m_szModuleName<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

                <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t n <span class="token operator">=</span> m_pImportDescriptor<span class="token punctuation">.</span>OriginalFirstThunk<span class="token punctuation">;</span> <span class="token punctuation">;</span> n <span class="token operator">+</span><span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_THUNK_DATA32<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    IMAGE_THUNK_DATA m_pThunkData <span class="token operator">=</span> m_Process<span class="token punctuation">.</span>Read<span class="token operator">&lt;</span>IMAGE_THUNK_DATA<span class="token operator">></span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_pThunkData<span class="token punctuation">.</span>u1<span class="token punctuation">.</span>AddressOfData<span class="token punctuation">)</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_pThunkData<span class="token punctuation">.</span>u1<span class="token punctuation">.</span>Ordinal <span class="token operator">&amp;</span> IMAGE_ORDINAL_FLAG32<span class="token punctuation">)</span>
                        <span class="token comment" spellcheck="true">// TODO: Imports by ordinal, dunno how I will make this nice.</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">// Read function name.</span>
                    <span class="token keyword">char</span> m_szFunctionName<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_ReadNameBytes <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>m_BaseAddress <span class="token operator">+</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">uintptr_t</span><span class="token punctuation">(</span>m_pThunkData<span class="token punctuation">.</span>u1<span class="token punctuation">.</span>AddressOfData<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> m_szFunctionName<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>m_szFunctionName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_ReadNameBytes <span class="token operator">==</span> <span class="token number">0u</span><span class="token punctuation">)</span>
                        <span class="token comment" spellcheck="true">// Something went wrong while reading imp name, don't cache this.</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>

                    m_szFunctionName<span class="token punctuation">[</span>MAX_PATH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">// Cache desired data.</span>
                    this<span class="token operator">-></span>m_ImportData<span class="token punctuation">[</span>m_szFunctionName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> m_szModuleName <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Ensure we found the target PE header.</span>
    bool PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_bIsValidInternal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get DOS header of PE image.</span>
    PIMAGE_DOS_HEADER PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetDOSHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_pDOSHeaders<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get NT headers of PE image.</span>
    PIMAGE_NT_HEADERS PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetNTHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token operator">-></span>m_nMismatchedArchitecture <span class="token operator">!=</span> <span class="token number">0u</span><span class="token punctuation">)</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Warning: Architecture of PE image was not expected by build type. Actual was 0x%X"</span><span class="token punctuation">,</span>
                this<span class="token operator">-></span>m_nMismatchedArchitecture<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> this<span class="token operator">-></span>m_pNTHeaders<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get specific data directory of PE image.</span>
    IMAGE_DATA_DIRECTORY PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetDataDirectory</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nDirIndex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nDirIndex <span class="token operator">></span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Prevent user from doing an oopsie OOB read.</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> this<span class="token operator">-></span>m_DirectoryData<span class="token punctuation">[</span>m_nDirIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get section data of PE image.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>SectionData_t<span class="token operator">></span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetSectionData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_SectionData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get exported functions' data of PE image.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>ExportData_t<span class="token operator">></span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetExportData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_ExportData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get imported functions' data of PE image.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>map<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token punctuation">,</span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>ImportData_t<span class="token operator">></span> PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetImportData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_ImportData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get debug directories data of PE image.</span>
    PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>DebugData_t PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetDebugData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_DebugData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// Convert relative virtual address to file offset.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nRva<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> SectionData <span class="token punctuation">:</span> this<span class="token operator">-></span><span class="token function">GetSectionData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nRva <span class="token operator">&lt;</span> SectionData<span class="token punctuation">.</span>m_Address <span class="token operator">||</span>
                m_nRva <span class="token operator">></span> SectionData<span class="token punctuation">.</span>m_Address <span class="token operator">+</span> SectionData<span class="token punctuation">.</span>m_Size<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> SectionData<span class="token punctuation">.</span>m_PointerToRawData <span class="token operator">+</span> m_nRva <span class="token operator">-</span> SectionData<span class="token punctuation">.</span>m_Address<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">OffsetToRva</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nOffset<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> SectionData <span class="token punctuation">:</span> this<span class="token operator">-></span><span class="token function">GetSectionData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nOffset <span class="token operator">&lt;</span> SectionData<span class="token punctuation">.</span>m_PointerToRawData <span class="token operator">||</span>
                m_nOffset <span class="token operator">></span> SectionData<span class="token punctuation">.</span>m_Address <span class="token operator">+</span> SectionData<span class="token punctuation">.</span>m_Size<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> SectionData<span class="token punctuation">.</span>m_Address <span class="token operator">+</span> m_nOffset <span class="token operator">-</span> SectionData<span class="token punctuation">.</span>m_PointerToRawData<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get certain section by address in memory.</span>
    PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span>SectionData_t PEHeaderData_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetSectionByAddress</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_nAddress<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Traverse all sections to find which one our address resides in.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> SectionData <span class="token punctuation">:</span> this<span class="token operator">-></span><span class="token function">GetSectionData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nAddress <span class="token operator">&lt;</span> SectionData<span class="token punctuation">.</span>m_Address <span class="token operator">||</span>
                m_nAddress <span class="token operator">></span> SectionData<span class="token punctuation">.</span>m_Address <span class="token operator">+</span> SectionData<span class="token punctuation">.</span>m_Size<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> SectionData<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Wtf. Couldn't find.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// ImageFile_t definitions and functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Used for parsing PE's from file.</span>
    ImageFile_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ImageFile_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szImagePath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>filesystem<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">exists</span><span class="token punctuation">(</span>m_szImagePath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"File at %s doesn't exist, or wasn't accessible."</span><span class="token punctuation">,</span> m_szImagePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Fill image buffer.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>ifstream <span class="token function">m_fFile</span><span class="token punctuation">(</span>m_szImagePath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>ios<span class="token punctuation">:</span><span class="token punctuation">:</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token operator">&amp;</span>m_ImageBuffer<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>istreambuf_iterator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span>m_fFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>istreambuf_iterator<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_fFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Parse PE header information.</span>
        m_PEHeaderData <span class="token operator">=</span> <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_ImageBuffer<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>m_ImageBuffer<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Used for parsing PE's from memory.</span>
    ImageFile_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ImageFile_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token operator">*</span> m_ImageBuffer<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nImageSize<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Copy over to object-specific variable to possibly use later.</span>
        this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>m_nImageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m_ImageBuffer<span class="token punctuation">,</span> m_nImageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Parse PE header information.</span>
        m_PEHeaderData <span class="token operator">=</span> <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Ensure we found the target PE image.</span>
    bool ImageFile_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get PE header data of PE image.</span>
    PEHeaderData_t ImageFile_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_PEHeaderData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> ImageFile_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">WriteToFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szFilePath<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>ofstream <span class="token function">file</span><span class="token punctuation">(</span>m_szFilePath<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>ios_base<span class="token punctuation">:</span><span class="token punctuation">:</span>out <span class="token operator">|</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>ios_base<span class="token punctuation">:</span><span class="token punctuation">:</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Unable to setup desired file.</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>CH_R_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> this<span class="token operator">-></span>m_ImageBuffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Driver_t definitions and functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Driver_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverPath<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Object-specific driver path.</span>
        this<span class="token operator">-></span>m_szDriverPath <span class="token operator">=</span> m_szDriverPath<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Initialize by driver information.</span>
    Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Driver_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverName<span class="token punctuation">,</span> DWORD m_dDesiredAccess<span class="token punctuation">,</span> DWORD m_dSharedMode<span class="token punctuation">,</span> DWORD m_dCreationDisposition<span class="token punctuation">,</span> DWORD m_dFlagsAndAttributes<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">=</span> <span class="token function">CreateFileA</span><span class="token punctuation">(</span>m_szDriverName<span class="token punctuation">,</span>
            m_dDesiredAccess<span class="token punctuation">,</span>
            m_dSharedMode<span class="token punctuation">,</span>
            nullptr<span class="token punctuation">,</span>
            m_dCreationDisposition<span class="token punctuation">,</span>
            m_dFlagsAndAttributes<span class="token punctuation">,</span>
            nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>false<span class="token punctuation">,</span> this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span> <span class="token string">"Failed to get HANDLE to desired service!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// For opening an HANDLE to a currently loaded driver.</span>
    bool Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">SetupHandle</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverName<span class="token punctuation">,</span> DWORD m_dDesiredAccess<span class="token punctuation">,</span> DWORD m_dSharedMode<span class="token punctuation">,</span> DWORD m_dCreationDisposition<span class="token punctuation">,</span> DWORD m_dFlagsAndAttributes<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">=</span> <span class="token function">CreateFileA</span><span class="token punctuation">(</span>m_szDriverName<span class="token punctuation">,</span>
            m_dDesiredAccess<span class="token punctuation">,</span>
            m_dSharedMode<span class="token punctuation">,</span>
            nullptr<span class="token punctuation">,</span>
            m_dCreationDisposition<span class="token punctuation">,</span>
            m_dFlagsAndAttributes<span class="token punctuation">,</span>
            nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// For destroying a HANDLE to a currently loaded driver.</span>
    bool Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">DestroyHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">||</span> this<span class="token operator">-></span>m_hTargetDriverHandle <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Sir, why have you tried to release this handle without ensuring it was setup correctly?!</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Tried to release an invalid HANDLE!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> bool m_bDidSucceed <span class="token operator">=</span> <span class="token function">CloseHandle</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetDriverHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m_bDidSucceed<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Send IOCTL request to the target driver, returning the response.</span>
    DWORD Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">SendIOCTL</span><span class="token punctuation">(</span>DWORD m_dControlCode<span class="token punctuation">,</span> LPVOID m_pInBuffer<span class="token punctuation">,</span> DWORD m_dBufferSize<span class="token punctuation">,</span> LPVOID m_pOutBuffer<span class="token punctuation">,</span> DWORD m_dOutBufferSize<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        DWORD m_dBytesReturned <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> BOOL m_bDidSucceed <span class="token operator">=</span> <span class="token function">DeviceIoControl</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hTargetDriverHandle<span class="token punctuation">,</span>
            m_dControlCode<span class="token punctuation">,</span> m_pInBuffer<span class="token punctuation">,</span>
            m_dBufferSize<span class="token punctuation">,</span> m_pOutBuffer<span class="token punctuation">,</span>
            m_dOutBufferSize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_dBytesReturned<span class="token punctuation">,</span>
            nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_bDidSucceed<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"DeviceIoControl failed with error code #%i!"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> m_dBytesReturned<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Loads a target driver through the service manager. Obviously, these drivers must be SIGNED.</span>
    SC_HANDLE Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">LoadDriver</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverPaths<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szDriverName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Create HANDLE to the service manager.</span>
        <span class="token keyword">const</span> SC_HANDLE m_hServiceManager <span class="token operator">=</span> <span class="token function">OpenSCManagerA</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">,</span> nullptr<span class="token punctuation">,</span> SC_MANAGER_CREATE_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_hServiceManager <span class="token operator">||</span> m_hServiceManager <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't obtain valid HANDLE to service manager!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>SC_HANDLE<span class="token operator">></span><span class="token punctuation">(</span>INVALID_HANDLE_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// Tell service manager to create&amp;intialize our service.</span>
        <span class="token keyword">const</span> SC_HANDLE m_hCreatedService <span class="token operator">=</span> <span class="token function">CreateServiceA</span><span class="token punctuation">(</span>m_hServiceManager<span class="token punctuation">,</span>
            m_szDriverName<span class="token punctuation">,</span> m_szDriverName<span class="token punctuation">,</span>
            SERVICE_START <span class="token operator">|</span> SERVICE_STOP <span class="token operator">|</span> DELETE<span class="token punctuation">,</span>
            SERVICE_KERNEL_DRIVER<span class="token punctuation">,</span> SERVICE_DEMAND_START<span class="token punctuation">,</span> SERVICE_ERROR_IGNORE<span class="token punctuation">,</span>
            m_szDriverPaths<span class="token punctuation">,</span> nullptr<span class="token punctuation">,</span> nullptr<span class="token punctuation">,</span> nullptr<span class="token punctuation">,</span> nullptr<span class="token punctuation">,</span> nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_hCreatedService <span class="token operator">||</span> m_hCreatedService <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Failed to create desired service!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>SC_HANDLE<span class="token operator">></span><span class="token punctuation">(</span>INVALID_HANDLE_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">ADD_SCOPE_HANDLER</span><span class="token punctuation">(</span>CloseServiceHandle<span class="token punctuation">,</span> m_hServiceManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Finally, start the service.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">StartServiceA</span><span class="token punctuation">(</span>m_hCreatedService<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> nullptr<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Failed to start desired service!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> CH_R_CAST<span class="token operator">&lt;</span>SC_HANDLE<span class="token operator">></span><span class="token punctuation">(</span>INVALID_HANDLE_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment" spellcheck="true">// Release unneeded handle.</span>
        <span class="token keyword">return</span> m_hCreatedService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Unloads a target driver that was previously loaded through the service manager.</span>
    <span class="token keyword">void</span> Driver_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">UnloadDriver</span><span class="token punctuation">(</span><span class="token keyword">const</span> SC_HANDLE m_hLoadedStartedService<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Send STOP signal to desired service.</span>
        SERVICE_STATUS m_ServiceStatus<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">ControlService</span><span class="token punctuation">(</span>m_hLoadedStartedService<span class="token punctuation">,</span> SERVICE_CONTROL_STOP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_ServiceStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Finally, delete the service.</span>
        <span class="token function">DeleteService</span><span class="token punctuation">(</span>m_hLoadedStartedService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Thread_t definitions and functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Initialize with TID.</span>
    Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Thread_t</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_dThreadID<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_dThreadID <span class="token operator">=</span> m_dThreadID<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">=</span> <span class="token function">OpenThread</span><span class="token punctuation">(</span>THREAD_ALL_ACCESS<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> this<span class="token operator">-></span>m_dThreadID<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Only release this HANDLE if we've actually got access to it.</span>
        this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Initialize with TID&amp;HANDLE.</span>
    Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Thread_t</span><span class="token punctuation">(</span>HANDLE m_hThreadHandle<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">=</span> m_hThreadHandle<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_dThreadID <span class="token operator">=</span> <span class="token function">GetThreadId</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// We should NEVER try to release this HANDLE, as it's a copy of another.</span>
        this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Default dtor</span>
    Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token function">Thread_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Not allowed to release this HANDLE, or was already released.</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span>
            this<span class="token operator">-></span>m_bShouldFreeHandleAtDestructor <span class="token operator">&amp;&amp;</span>
            this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">&amp;&amp;</span>
            this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// FIXME:</span>
        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> warning( push )</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> warning( disable : 6258 ) </span><span class="token comment" spellcheck="true">// Using TerminateThread does not allow proper thread clean.</span>
    <span class="token comment" spellcheck="true">// Terminating a target thread.</span>
    <span class="token keyword">void</span> Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span> <span class="token string">"Tried to terminate a target thread with an empty HANDLE!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">TerminateThread</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">,</span> EXIT_FAILURE<span class="token comment" spellcheck="true">/*To give some sort of graceful termination.*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Can we even do this? Common sense dictates no.</span>
    <span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> warning( pop )</span>

    <span class="token comment" spellcheck="true">// Suspending a target thread.</span>
    <span class="token keyword">void</span> Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span> <span class="token string">"Tried to suspend a target thread with an empty HANDLE!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bIsThreadManuallySuspended <span class="token operator">=</span> <span class="token function">SuspendThread</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Resuming a target thread.</span>
    <span class="token keyword">void</span> Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">,</span> <span class="token string">"Tried to resume a target thread with an empty HANDLE!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_bIsThreadManuallySuspended <span class="token operator">=</span> <span class="token function">ResumeThread</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> <span class="token operator">!</span>this<span class="token operator">-></span>m_bIsThreadManuallySuspended<span class="token punctuation">,</span> <span class="token string">"Failed to resume thread with TID %i!"</span><span class="token punctuation">,</span> this<span class="token operator">-></span>m_dThreadID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get context of this thread.</span>
    CONTEXT Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetThreadCTX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        CONTEXT result<span class="token punctuation">;</span> <span class="token punctuation">{</span> result<span class="token punctuation">.</span>ContextFlags <span class="token operator">=</span> CONTEXT_FULL<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token function">GetThreadContext</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Set context of this thread.</span>
    <span class="token keyword">void</span> Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">SetThreadCTX</span><span class="token punctuation">(</span>CONTEXT m_Context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">SetThreadContext</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_Context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Check which module this thread is associated with.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>string Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetOwningModule</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> bool m_bUseCachedData<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_StartAddress <span class="token operator">=</span> this<span class="token operator">-></span><span class="token function">GetStartAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_StartAddress <span class="token operator">==</span> <span class="token number">0u</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// Weird, shouldn't happen unless we have no valid HANDLE.</span>
            <span class="token keyword">return</span> <span class="token string">"N/A (Couldn't find thread start address.)"</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Traverse through all loaded modules, and determine where our thread lies in.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> CurrentModule <span class="token punctuation">:</span> m_Process<span class="token punctuation">.</span><span class="token function">EnumerateModules</span><span class="token punctuation">(</span>m_bUseCachedData<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m_StartAddress <span class="token operator">&lt;</span> CurrentModule<span class="token punctuation">.</span>m_BaseAddress <span class="token operator">||</span>
                m_StartAddress <span class="token operator">></span> CurrentModule<span class="token punctuation">.</span>m_BaseAddress <span class="token operator">+</span> CurrentModule<span class="token punctuation">.</span>m_nSize<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> CurrentModule<span class="token punctuation">.</span>m_szName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">"N/A (Passing through false as default parameter should be your solution.)"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Ensure we found a HANDLE to the target thread.</span>
    bool Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_hThreadHandle <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Is the target thread suspended?</span>
    bool Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        bool m_bIsThreadSuspended <span class="token operator">=</span> <span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> WAIT_ABANDONED<span class="token punctuation">;</span>
        <span class="token keyword">return</span> m_bIsThreadSuspended<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Did we suspend the target thread ourselves?</span>
    bool Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsManuallySuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_bIsThreadManuallySuspended<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Get's the start address of a target thread.</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t Thread_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetStartAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        NtQueryInformationThread_fn NtQueryInformationThread <span class="token operator">=</span>
            CH_R_CAST<span class="token operator">&lt;</span>NtQueryInformationThread_fn<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtQueryInformationThread"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_dThreadStartAddress <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token function">NtQueryInformationThread</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_hThreadHandle<span class="token punctuation">,</span> THREADINFOCLASS<span class="token punctuation">:</span><span class="token punctuation">:</span>ThreadQuerySetWin32StartAddress<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_dThreadStartAddress<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t<span class="token punctuation">)</span><span class="token punctuation">,</span> nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m_dThreadStartAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Module_t definitions and functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Setup module in process by (non-case sensitive) name. </span>
    Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Module_t</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_szModuleName<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Walk all loaded modules until we land on the wish module.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> CurrentModule <span class="token punctuation">:</span> m_Process<span class="token punctuation">.</span><span class="token function">EnumerateModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">strcmp</span><span class="token punctuation">(</span>CurrentModule<span class="token punctuation">.</span>m_szName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_szModuleName<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            this<span class="token operator">-></span>m_dModuleBaseAddress <span class="token operator">=</span> CurrentModule<span class="token punctuation">.</span>m_BaseAddress<span class="token punctuation">;</span>
            this<span class="token operator">-></span>m_dModuleSize <span class="token operator">=</span> CurrentModule<span class="token punctuation">.</span>m_nSize<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Found what we needed, exit loop.</span>
        <span class="token punctuation">}</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> this<span class="token operator">-></span>m_dModuleBaseAddress <span class="token operator">&amp;&amp;</span> this<span class="token operator">-></span>m_dModuleSize<span class="token punctuation">,</span> <span class="token string">"Couldn't find desired module %s"</span><span class="token punctuation">,</span> m_szModuleName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span><span class="token function">SetupModule_Internal</span><span class="token punctuation">(</span>m_Process<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Setup module in process by address in processes' memory space.</span>
    Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Module_t</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uintptr_t m_dModuleBaseAddress<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint32_t m_dModuleSize<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        this<span class="token operator">-></span>m_dModuleBaseAddress <span class="token operator">=</span> m_dModuleBaseAddress<span class="token punctuation">;</span>
        this<span class="token operator">-></span>m_dModuleSize <span class="token operator">=</span> m_dModuleSize<span class="token punctuation">;</span>

        this<span class="token operator">-></span><span class="token function">SetupModule_Internal</span><span class="token punctuation">(</span>m_Process<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">SetupModule_Internal</span><span class="token punctuation">(</span>chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t<span class="token operator">&amp;</span> m_Process<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>int32_t m_ParseType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Read whole module to our buffer in heap.</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> m_ModuleDataTemp <span class="token operator">=</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>make_unique<span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>uint8_t<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_dModuleSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t m_nReadBytes <span class="token operator">=</span> m_Process<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>this<span class="token operator">-></span>m_dModuleBaseAddress<span class="token punctuation">,</span> m_ModuleDataTemp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> this<span class="token operator">-></span>m_dModuleSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">CH_ASSERT</span><span class="token punctuation">(</span>true<span class="token punctuation">,</span> m_nReadBytes <span class="token operator">!=</span> <span class="token number">0u</span><span class="token punctuation">,</span> <span class="token string">"Failed to read image of desired module."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Ensure vector holding image buffer has sufficient size.</span>
        this<span class="token operator">-></span>m_ModuleData<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>m_nReadBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Copy over read data from this module.</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>this<span class="token operator">-></span>m_ModuleData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m_ModuleDataTemp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_nReadBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        this<span class="token operator">-></span>m_PEHeaderData <span class="token operator">=</span> <span class="token function">PEHeaderData_t</span><span class="token punctuation">(</span>m_Process<span class="token punctuation">,</span> m_ParseType<span class="token punctuation">,</span> this<span class="token operator">-></span>m_dModuleBaseAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get PE header data of target process.</span>
    PEHeaderData_t Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetPEHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_PEHeaderData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Helper function to get module data of target process.</span>
    ByteArray_t Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GetModuleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_ModuleData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Ensure we found the target module in memory.</span>
    bool Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> this<span class="token operator">-></span>m_ModuleData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Address_t Module_t<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">FindIDASignature</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string_view m_szSignature<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">auto</span> ToBytes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string_view m_szSignature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> byteArray <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span> m_pStart <span class="token operator">=</span> CH_C_CAST<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>m_szSignature<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span> m_pEnd <span class="token operator">=</span> m_pStart <span class="token operator">+</span> m_szSignature<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> m_pCurrent <span class="token operator">=</span> m_pStart<span class="token punctuation">;</span> m_pCurrent <span class="token operator">&lt;</span> m_pEnd<span class="token punctuation">;</span> <span class="token operator">++</span>m_pCurrent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>m_pCurrent <span class="token operator">==</span> <span class="token string">'?'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token operator">++</span>m_pCurrent<span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>m_pCurrent <span class="token operator">==</span> <span class="token string">'?'</span><span class="token punctuation">)</span>
                        <span class="token operator">++</span>m_pCurrent<span class="token punctuation">;</span>

                    byteArray<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                    byteArray<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">strtoul</span><span class="token punctuation">(</span>m_pCurrent<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_pCurrent<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> byteArray<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>m_dModuleSize <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Invalid module provided."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">Address_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// can't be ByteArray_t type because of wildcards.</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> m_byteArray <span class="token operator">=</span> <span class="token function">ToBytes</span><span class="token punctuation">(</span>m_szSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t nSize <span class="token operator">=</span> m_byteArray<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> pBytes <span class="token operator">=</span> m_byteArray<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Find matching sequences.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_dModuleSize <span class="token operator">-</span> nSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bool bFound <span class="token operator">=</span> true<span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t j <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> nSize<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>pBytes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> m_ModuleData<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">!=</span> pBytes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    bFound <span class="token operator">=</span> false<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>bFound<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token function">Address_t</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_ModuleData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Couldn't find IDA signature %s."</span><span class="token punctuation">,</span> m_szSignature<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">Address_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Miscelleanous functions.</span>
namespace chdr
<span class="token punctuation">{</span>
    namespace misc
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="简单使用样例"><a href="#简单使用样例" class="headerlink" title="简单使用样例"></a>简单使用样例</h3><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"chdr.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    chdr<span class="token punctuation">:</span><span class="token punctuation">:</span>Process_t <span class="token function">targetProcess</span><span class="token punctuation">(</span>L<span class="token string">"Calculator.exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Pid : %d"</span><span class="token punctuation">,</span> targetProcess<span class="token punctuation">.</span><span class="token function">GetProcessID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"Path : %s"</span><span class="token punctuation">,</span> targetProcess<span class="token punctuation">.</span><span class="token function">GetPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> i <span class="token punctuation">:</span> targetProcess<span class="token punctuation">.</span><span class="token function">EnumerateModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CH_LOG</span><span class="token punctuation">(</span><span class="token string">"ModuleName : %s"</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>m_szName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://airshelf.github.io/2022/01/26/chdr/" title="进程模块库" target="_blank" rel="external">http://airshelf.github.io/2022/01/26/chdr/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/airshelf" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/male.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/airshelf" target="_blank"><span class="text-dark">Airshelf</span><small class="ml-1x">Day Day Up</small></a></h3>
        <div>自律 == 自由，冲，永远少年。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    
    <li class="next">
      <a href="/2022/01/25/StrongDel/" title="内核强删文件"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <div class="copyright">
    	
        <!-- <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div> -->
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'DTEQb4XAyBxOQ5KMMeKIzaBz-gzGzoHsz',
    appKey: 'U0jt5rQRkgRiFxfu3baNhCqv',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>